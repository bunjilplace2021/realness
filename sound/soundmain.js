/*! For license information please see soundmain.js.LICENSE.txt */
(()=>{var t,e,n={228:t=>{t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}},858:t=>{t.exports=function(t){if(Array.isArray(t))return t}},575:t=>{t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},913:t=>{function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}t.exports=function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}},884:t=>{t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],s=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(s=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);s=!0);}catch(t){i=!0,r=t}finally{try{s||null==a.return||a.return()}finally{if(i)throw r}}return n}}},521:t=>{t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},38:(t,e,n)=>{var s=n(858),i=n(884),r=n(379),o=n(521);t.exports=function(t,e){return s(t)||i(t,e)||r(t,e)||o()}},379:(t,e,n)=>{var s=n(228);t.exports=function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}},382:function(t,e,n){!function(t,e,n,s){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(e),o=i(n),a=i(s),c=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},u=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},h=function(t,e){return{startTime:e,type:"setValue",value:t}},l=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},p=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},d=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},m=function(t){return d(t)||f(t)},_=function(t){return"setValue"===t.type},g=function(t){return"setValueCurve"===t.type},v=function t(e,n,s,i){var r=e[n];return void 0===r?i:m(r)||_(r)?r.value:g(r)?r.values[r.values.length-1]:p(s,t(e,n-1,r.startTime,i),r)},y=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:m(n)?[n.endTime,n.value]:_(n)?[n.startTime,n.value]:g(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,v(t,e-1,n.startTime,i)]},w=function(t){return"cancelAndHold"===t.type},b=function(t){return"cancelScheduledValues"===t.type},x=function(t){return w(t)||b(t)?t.cancelTime:d(t)||f(t)?t.endTime:t.startTime},T=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},C=function(t,e,n,s){return n+(t-e)/(s.endTime-e)*(s.value-n)},S=function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]},k=function(t,e){var n=e.duration,s=e.startTime,i=e.values,r=(t-s)/n*(i.length-1);return S(i,r)},A=function(t){return"setTarget"===t.type},O=function(){function t(e){o.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return a.default(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=x(t);if(w(t)||b(t)){var n=this._automationEvents.findIndex((function(n){return b(t)&&g(n)?n.startTime+n.duration>=e:x(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),w(t)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&m(s)){if(A(i))throw new Error("The internal list is malformed.");var r=g(i)?i.startTime+i.duration:x(i),o=g(i)?i.values[i.values.length-1]:i.value,a=d(s)?T(e,r,o,s):C(e,r,o,s),p=d(s)?c(a,e,this._currenTime):u(a,e,this._currenTime);this._automationEvents.push(p)}void 0!==i&&A(i)&&this._automationEvents.push(h(this.getValue(e),e)),void 0!==i&&g(i)&&i.startTime+i.duration>e&&(this._automationEvents[this._automationEvents.length-1]=l(new Float32Array([6,7]),i.startTime,e-i.startTime))}}else{var _=this._automationEvents.findIndex((function(t){return x(t)>e})),v=-1===_?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[_-1];if(void 0!==v&&g(v)&&x(v)+v.duration>e)return!1;var y=d(t)?c(t.value,t.endTime,this._currenTime):f(t)?u(t.value,e,this._currenTime):t;if(-1===_)this._automationEvents.push(y);else{if(g(t)&&e+t.duration>x(this._automationEvents[_]))return!1;this._automationEvents.splice(_,0,y)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return x(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];A(s)&&n.unshift(h(v(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents[this._automationEvents.length-1],n=this._automationEvents.findIndex((function(e){return x(e)>t})),s=this._automationEvents[n],i=x(e)<=t?e:this._automationEvents[n-1];if(void 0!==i&&A(i)&&(void 0===s||!m(s)||s.insertTime>t))return p(t,v(this._automationEvents,n-2,i.startTime,this._defaultValue),i);if(void 0!==i&&_(i)&&(void 0===s||!m(s)))return i.value;if(void 0!==i&&g(i)&&(void 0===s||!m(s)||i.startTime+i.duration>t))return t<i.startTime+i.duration?k(t,i):i.values[i.values.length-1];if(void 0!==i&&m(i)&&(void 0===s||!m(s)))return i.value;if(void 0!==s&&d(s)){var o=y(this._automationEvents,n-1,i,s,this._defaultValue),a=r.default(o,2),c=a[0],u=a[1];return T(t,c,u,s)}if(void 0!==s&&f(s)){var h=y(this._automationEvents,n-1,i,s,this._defaultValue),l=r.default(h,2),w=l[0],b=l[1];return C(t,w,b,s)}return this._defaultValue}}]),t}(),E=function(t){return{cancelTime:t,type:"cancelAndHold"}},R=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},M=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},D=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},I=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}};t.AutomationEventList=O,t.createCancelAndHoldAutomationEvent=E,t.createCancelScheduledValuesAutomationEvent=R,t.createExponentialRampToValueAutomationEvent=M,t.createLinearRampToValueAutomationEvent=D,t.createSetTargetAutomationEvent=I,t.createSetValueAutomationEvent=h,t.createSetValueCurveAutomationEvent=l,Object.defineProperty(t,"__esModule",{value:!0})}(e,n(38),n(575),n(913))},666:t=>{var e=function(t){"use strict";var e,n=Object.prototype,s=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,s){var i=e&&e.prototype instanceof _?e:_,r=Object.create(i.prototype),o=new O(s||[]);return r._invoke=function(t,e,n){var s=l;return function(i,r){if(s===d)throw new Error("Generator is already running");if(s===f){if("throw"===i)throw r;return R()}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var a=S(o,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===l)throw s=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=d;var c=h(t,e,n);if("normal"===c.type){if(s=n.done?f:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=f,n.method="throw",n.arg=c.arg)}}}(t,n,o),r}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l="suspendedStart",p="suspendedYield",d="executing",f="completed",m={};function _(){}function g(){}function v(){}var y={};y[r]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(E([])));b&&b!==n&&s.call(b,r)&&(y=b);var x=v.prototype=_.prototype=Object.create(y);function T(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(i,r,o,a){var c=h(t[i],t,r);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&s.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var i;this._invoke=function(t,s){function r(){return new e((function(e,i){n(t,s,e,i)}))}return i=i?i.then(r,r):r()}}function S(t,n){var s=t.iterator[n.method];if(s===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=h(s,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var r=i.arg;return r?r.done?(n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function E(t){if(t){var n=t[r];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(s.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:R}}function R(){return{value:e,done:!0}}return g.prototype=x.constructor=v,v.constructor=g,g.displayName=c(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,a,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},T(C.prototype),C.prototype[o]=function(){return this},t.AsyncIterator=C,t.async=function(e,n,s,i,r){void 0===r&&(r=Promise);var o=new C(u(e,n,s,i),r);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},T(x),c(x,a,"Generator"),x[r]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var s=e.pop();if(s in t)return n.value=s,n.done=!1,n}return n.done=!0,n}},t.values=E,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(s,i){return a.type="throw",a.arg=t,n.next=s,i&&(n.method="next",n.arg=e),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=s.call(o,"catchLoc"),u=s.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&s.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var s=n.completion;if("throw"===s.type){var i=s.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,s){return this.delegate={iterator:E(t),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}},877:(t,e,n)=>{var s=n(570),i=n(171),r=i;r.v1=s,r.v4=i,t.exports=r},327:t=>{for(var e=[],n=0;n<256;++n)e[n]=(n+256).toString(16).substr(1);t.exports=function(t,n){var s=n||0,i=e;return[i[t[s++]],i[t[s++]],i[t[s++]],i[t[s++]],"-",i[t[s++]],i[t[s++]],"-",i[t[s++]],i[t[s++]],"-",i[t[s++]],i[t[s++]],"-",i[t[s++]],i[t[s++]],i[t[s++]],i[t[s++]],i[t[s++]],i[t[s++]]].join("")}},217:t=>{var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var n=new Uint8Array(16);t.exports=function(){return e(n),n}}else{var s=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s}}},570:(t,e,n)=>{var s,i,r=n(217),o=n(327),a=0,c=0;t.exports=function(t,e,n){var u=e&&n||0,h=e||[],l=(t=t||{}).node||s,p=void 0!==t.clockseq?t.clockseq:i;if(null==l||null==p){var d=r();null==l&&(l=s=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=i=16383&(d[6]<<8|d[7]))}var f=void 0!==t.msecs?t.msecs:(new Date).getTime(),m=void 0!==t.nsecs?t.nsecs:c+1,_=f-a+(m-c)/1e4;if(_<0&&void 0===t.clockseq&&(p=p+1&16383),(_<0||f>a)&&void 0===t.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=m,i=p;var g=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;h[u++]=g>>>24&255,h[u++]=g>>>16&255,h[u++]=g>>>8&255,h[u++]=255&g;var v=f/4294967296*1e4&268435455;h[u++]=v>>>8&255,h[u++]=255&v,h[u++]=v>>>24&15|16,h[u++]=v>>>16&255,h[u++]=p>>>8|128,h[u++]=255&p;for(var y=0;y<6;++y)h[u+y]=l[y];return e||o(h)}},171:(t,e,n)=>{var s=n(217),i=n(327);t.exports=function(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var a=0;a<16;++a)e[r+a]=o[a];return e||i(o)}}},s={};function i(t){if(s[t])return s[t].exports;var e=s[t]={exports:{}};return n[t].call(e.exports,e,e.exports,i),e.exports}i.m=n,i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,n)=>(i.f[n](t,e),e)),[])),i.u=t=>t+".soundmain.js",i.miniCssF=t=>"main."+{785:"44c03e1a36fbdcdc8d49",823:"11c431d6b1afca77f6c1"}[t]+".css",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="realness:",i.l=(n,s,r)=>{if(t[n])t[n].push(s);else{var o,a;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==e+r){o=h;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",e+r),o.src=n),t[n]=[s];var l=(e,s)=>{o.onerror=o.onload=null,clearTimeout(p);var i=t[n];if(delete t[n],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((t=>t(s))),e)return e(s)},p=setTimeout(l.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=l.bind(null,o.onerror),o.onload=l.bind(null,o.onload),a&&document.head.appendChild(o)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={179:0};i.f.j=(e,n)=>{var s=i.o(t,e)?t[e]:void 0;if(0!==s)if(s)n.push(s[2]);else{var r=new Promise(((n,i)=>{s=t[e]=[n,i]}));n.push(s[2]=r);var o=i.p+i.u(e),a=new Error;i.l(o,(n=>{if(i.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,s[1](a)}}),"chunk-"+e)}};var e=self.webpackChunkrealness=self.webpackChunkrealness||[],n=e.push.bind(e);e.push=e=>{for(var s,r,[o,a,c]=e,u=0,h=[];u<o.length;u++)r=o[u],i.o(t,r)&&t[r]&&h.push(t[r][0]),t[r]=0;for(s in a)i.o(a,s)&&(i.m[s]=a[s]);for(c&&c(i),n(e);h.length;)h.shift()()}})(),(()=>{"use strict";const t="14.8.9";var e=i(382);const n=new WeakSet,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,p=new WeakMap,d={construct:()=>d},f=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,m=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(f);for(;null!==i;){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(f)}return[n.join(";"),s]},_=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},g=t=>{if(!(t=>{try{new new Proxy(t,d)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},v=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},y=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},w=(t,e,n,s)=>{const i=v(t,e),r=y(i,(t=>t[0]===n&&t[1]===s));return 0===i.size&&t.delete(e),r},b=t=>v(u,t),x=t=>{if(n.has(t))throw new Error("The AudioNode is already stored.");n.add(t),b(t).forEach((t=>t(!0)))},T=t=>"port"in t,C=t=>{if(!n.has(t))throw new Error("The AudioNode is not stored.");n.delete(t),b(t).forEach((t=>t(!1)))},S=(t,e)=>{!T(t)&&e.every((t=>0===t.size))&&C(t)},k={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},A=(t,e)=>t.context===e,O=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},E=()=>new DOMException("","IndexSizeError"),R=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw E();throw t}})},M={numberOfChannels:1},D=-34028234663852886e22,I=-D,P=t=>n.has(t),N={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},V=t=>v(s,t),q=t=>v(o,t),L=(t,e)=>{const{activeInputs:n}=V(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||L(n,[...e,t])}))));const s=(t=>"playbackRate"in t)(t)?[t.playbackRate]:T(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of s){const n=q(t);void 0!==n&&n.activeInputs.forEach((([t])=>L(t,e)))}P(t)&&C(t)},F=t=>{L(t.destination,[])},j=t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t),B=t=>"context"in t,U=t=>B(t[0]),z=(t,e,n,s)=>{for(const e of t)if(n(e)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},W=(t,e,[n,s],i)=>{z(t,[e,n,s],(t=>t[0]===e&&t[1]===n),i)},G=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):z(r,[n,s],(t=>t[0]===n),i)},H=t=>"inputs"in t,X=(t,e,n,s)=>{if(H(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},Y=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},$=(t,e)=>{if(!b(t).delete(e))throw new Error("Missing the expected event listener.")},Z=(t,e,n)=>{const s=v(t,e),i=y(s,(t=>t[0]===n));return 0===s.size&&t.delete(e),i},Q=(t,e,n,s)=>{H(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},J=t=>v(r,t),K=t=>v(a,t),tt=t=>h.has(t),et=t=>!n.has(t),nt=t=>new Promise((e=>{const n=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(n).connect(t.destination),o.connect(s),o.disconnect(s),n.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?e(!0):e(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(t.destination)},o.start()})),st=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},it=t=>"context"in t,rt=t=>{const e=new Map;t.connect=(t=>(n,s=0,i=0)=>{const r=it(n)?t(n,s,i):t(n,s),o=e.get(n);return void 0===o?e.set(n,[{input:i,output:s}]):o.every((t=>t.input!==i||t.output!==s))&&o.push({input:i,output:s}),r})(t.connect.bind(t)),t.disconnect=(n=>(s,i,r)=>{if(n.apply(t),void 0===s)e.clear();else if("number"==typeof s)for(const[t,n]of e){const i=n.filter((t=>t.output!==s));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(s))if(void 0===i)e.delete(s);else{const t=e.get(s);if(void 0!==t){const n=t.filter((t=>t.output!==i&&(t.input!==r||void 0===r)));0===n.length?e.delete(s):e.set(s,n)}}for(const[n,s]of e)s.forEach((e=>{it(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})(t.disconnect)},ot=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=q(e),{outputs:o}=V(t),a=b(t),c=o=>{const a=J(t),c=K(e);if(o){const e=Z(r,t,n);W(i,t,e,!1),s||tt(t)||a.connect(c,n)}else{const e=((t,e,n)=>y(t,(t=>t[0]===e&&t[1]===n)))(i,t,n);G(r,e,!1),s||tt(t)||a.disconnect(c,n)}};return!!z(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(c),P(t)?W(i,t,[n,c],!0):G(r,[t,n,c],!0),!0)},at=(t,e,n,s,i)=>{const[r,o]=((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=V(e),o=Y(i[s],t,n);if(null===o)return[w(r,t,n,s)[2],!1];return[o[2],!0]})(t,n,s,i);if(null!==r&&($(t,r),!o||e||tt(t)||Q(J(t),J(n),s,i)),P(n)){const{activeInputs:t}=V(n);S(n,t)}},ct=(t,e,n,s)=>{const[i,r]=((t,e,n)=>{const{activeInputs:s,passiveInputs:i}=q(e),r=Y(s,t,n);if(null===r)return[Z(i,t,n)[1],!1];return[r[2],!0]})(t,n,s);null!==i&&($(t,i),!r||e||tt(t)||J(t).disconnect(K(n),s))};class ut{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,s)=>t.call(e,n,s,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const ht={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function lt(t,e,n,s,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const pt=(t,e,n,s,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},dt=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"==typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},ft=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,c=s.channelCount*s.numberOfInputs,u=i.reduce(((t,e)=>t+e),0),h=0===u?null:n.createBuffer(u,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const l=V(t),d=await((t,e)=>{const n=v(p,t),s=J(e);return v(n,s)})(n,t),f=dt(s.numberOfInputs,s.channelCount),m=dt(s.numberOfOutputs,i),_=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let u=0;u<a;u+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)lt(e,f[t],n,n,u);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{lt(e,_,t,c+n,u)}));for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===m[t][e].byteLength&&(m[t][e]=new Float32Array(128));try{const t=f.map(((t,e)=>0===l.activeInputs[e].size?[]:t)),e=o(u/n.sampleRate,n.sampleRate,(()=>d.process(t,m,_)));if(null!==h)for(let t=0,e=0;t<s.numberOfOutputs;t+=1){for(let n=0;n<i[t];n+=1)pt(h,m[t],n,e+n,u);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return h},mt={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},_t={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},gt={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},vt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},yt={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},wt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},bt=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},xt={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Tt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Ct=()=>new DOMException("","InvalidStateError"),St=()=>new DOMException("","InvalidAccessError"),kt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},At=(t,e,n,s,i,r,o,a,c,u,h)=>{const l=u.length;let p=a;for(let a=0;a<l;a+=1){let l=n[0]*u[a];for(let e=1;e<i;e+=1){const s=p-e&c-1;l+=n[e]*r[s],l-=t[e]*o[s]}for(let t=i;t<s;t+=1)l+=n[t]*r[p-t&c-1];for(let n=i;n<e;n+=1)l-=t[n]*o[p-n&c-1];r[p]=u[a],o[p]=l,p=p+1&c-1,h[a]=l}return p},Ot={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Et=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},Rt={numberOfChannels:1},Mt=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},Dt=(t,e)=>{Mt(t,e,"channelCount"),Mt(t,e,"channelCountMode"),Mt(t,e,"channelInterpretation")},It=t=>"function"==typeof t.getFloatTimeDomainData,Pt=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},Nt=t=>{t.start=(e=>(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})(t.start)},Vt=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},qt=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Lt=async(t,e)=>new t(await(t=>new Promise(((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)})))(e)),Ft=(t,e)=>{const n=t.createBiquadFilter();return Dt(n,e),Pt(n,e,"Q"),Pt(n,e,"detune"),Pt(n,e,"frequency"),Pt(n,e,"gain"),Mt(n,e,"type"),n},jt=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Dt(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Ct()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw Ct()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw Ct()}})})(n),n},Bt=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Ut=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Dt(n,e),Pt(n,e,"delayTime"),n},zt=(t,e)=>{const n=t.createGain();return Dt(n,e),Pt(n,e,"gain"),n};function Wt(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function Gt(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)i=e,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=t[r];var s,i;return n}const Ht=(t,e,n,s)=>t.createScriptProcessor(e,n,s),Xt=()=>new DOMException("","NotSupportedError"),Yt={numberOfChannels:1},$t={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Zt={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Qt={disableNormalization:!1},Jt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Kt=()=>new DOMException("","UnknownError"),te={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ee=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},ne=(t,e,n,s)=>{let i=Object.getPrototypeOf(t);for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},se=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(s){if(9!==s.code)throw s;se(t,e,n+1e-7)}},ie=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},re=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},oe=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},ae=(t,e)=>{const n=e.createGain();t.connect(n);const s=(e=>()=>{e.call(t,n),t.removeEventListener("ended",s)})(t.disconnect);t.addEventListener("ended",s),Bt(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},ce=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},ue=(t=>(e,n,[s,i,r],o)=>{t(e[i],[n,s,r],(t=>t[0]===n&&t[1]===s),o)})(z),he=(t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],(t=>t[0]===i&&t[1]===n),o)})(z),le=(t=>(e,n,s,i)=>t(e[i],(t=>t[0]===n&&t[1]===s)))(y),pe=new WeakMap,de=(t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0})(pe),fe=(me=new Map,_e=new WeakMap,(t,e)=>{const n=_e.get(t);if(void 0!==n)return n;const s=me.get(t);if(void 0!==s)return s;try{const n=e();return n instanceof Promise?(me.set(t,n),n.catch((()=>!1)).then((e=>(me.delete(t),_e.set(t,e),e)))):(_e.set(t,n),n)}catch{return _e.set(t,!1),!1}});var me,_e;const ge="undefined"==typeof window?null:window,ve=((t,e)=>(n,s)=>{const i=n.createAnalyser();if(Dt(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Mt(i,s,"fftSize"),Mt(i,s,"maxDecibels"),Mt(i,s,"minDecibels"),Mt(i,s,"smoothingTimeConstant"),t(It,(()=>It(i)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}})(i),i})(fe,E),ye=(t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(V),we=((t,e,n)=>async(s,i,r,o)=>{const a=t(s),c=[...o,s];await Promise.all(a.activeInputs.map(((t,o)=>Array.from(t).filter((([t])=>!c.includes(t))).map((async([t,a])=>{const u=e(t),h=await u.render(t,i,c),l=s.context.destination;n(t)||s===l&&n(s)||h.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(V,ye,tt),be=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!A(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(ve,J,we),xe=(Te=c,t=>{const e=Te.get(t);if(void 0===e)throw Ct();return e});var Te;const Ce=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(ge),Se=(t=>e=>null!==t&&e instanceof t)(Ce),ke=new WeakMap,Ae=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=t(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(e,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}})(ce),Oe=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(ge),Ee=(t=>e=>null!==t&&e instanceof t)(Oe),Re=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(ge),Me=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(ge),De=((t,e,n,s,i,o,a,c,h,l,p,d,f,m,_)=>class extends l{constructor(e,s,i,o){super(i),this._context=e,this._nativeAudioNode=i;const a=p(e);d(a)&&!0!==n(nt,(()=>nt(a)))&&rt(i),r.set(this,i),u.set(this,new Set),"closed"!==e.state&&s&&x(this),t(this,o,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,r=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=p(this._context),u=_(c);if(f(t)||m(t))throw o();if(B(t)){const i=J(t);try{const e=X(this._nativeAudioNode,i,n,r),s=et(this);(u||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&et(t)&&x(t)}catch(t){if(12===t.code)throw o();throw t}if(e(this,t,n,r,u)){const e=h([this],t);st(e,s(u))}return t}const l=K(t);if("playbackRate"===l.name)throw a();try{this._nativeAudioNode.connect(l,n),(u||et(this))&&this._nativeAudioNode.disconnect(l,n)}catch(t){if(12===t.code)throw o();throw t}if(ot(this,t,n,u)){const e=h([this],t);st(e,s(u))}}disconnect(t,e,n){let s;const r=p(this._context),a=_(r);if(void 0===t)s=((t,e)=>{const n=V(t),s=[];for(const i of n.outputs)U(i)?at(t,e,...i):ct(t,e,...i),s.push(i[0]);return n.outputs.clear(),s})(this,a);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=((t,e,n)=>{const s=V(t),i=[];for(const r of s.outputs)r[1]===n&&(U(r)?at(t,e,...r):ct(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,a,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(B(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=((t,e,n,s,i)=>{const r=V(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==s&&t[1]!==s||void 0!==i&&t[2]!==i))).map((n=>(U(n)?at(t,e,...n):ct(t,e,...n),r.outputs.delete(n),n[0])))})(this,a,t,e,n),0===s.length)throw o()}for(const t of s){const e=h([this],t);st(e,c)}}})((Ie=s,(t,e,n)=>{const s=[];for(let t=0;t<n.numberOfInputs;t+=1)s.push(new Set);Ie.set(t,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,s,i,r,o,a,c,u,h,l,p)=>{const d=new WeakMap;return(f,m,_,g,v)=>{const{activeInputs:y,passiveInputs:b}=r(m),{outputs:T}=r(f),C=a(f),k=r=>{const a=c(m),u=c(f);if(r){const e=w(b,f,_,g);t(y,f,e,!1),v||l(f)||n(u,a,_,g),p(m)&&x(m)}else{const t=s(y,f,_,g);e(b,g,t,!1),v||l(f)||i(u,a,_,g);const n=o(m);if(0===n)h(m)&&S(m,y);else{const t=d.get(m);void 0!==t&&clearTimeout(t),d.set(m,setTimeout((()=>{h(m)&&S(m,y)}),1e3*n))}}};return!!u(T,[m,_,g],(t=>t[0]===m&&t[1]===_&&t[2]===g),!0)&&(C.add(k),h(f)?t(y,f,[_,g,k],!0):e(b,g,[f,_,k],!0),!0)}})(ue,he,X,le,Q,V,de,b,J,z,P,tt,et),fe,((t,e,n,s,i,r)=>o=>(a,c)=>{const u=t.get(a);if(void 0===u){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(U(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,c)}else t.set(a,u+c)})(h,Q,V,J,K,P),E,St,Xt,((t,e,n,s,i,r,o,a)=>(c,u)=>{const h=e.get(c);if(void 0===h)throw new Error("Missing the expected cycle count.");const l=r(c.context),p=a(l);if(h===u){if(e.delete(c),!p&&o(c)){const e=s(c),{outputs:r}=n(c);for(const n of r)if(U(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(c,h-u)})(X,h,V,J,K,xe,P,Se),((t,e,n)=>function s(i,r){const o=B(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>s([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(ke,V,v),Ae,xe,Ee,Re,Me,Se);var Ie;const Pe=((t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...k,...n},c=s(o,a);super(t,!1,c,r(o)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(De,be,E,ve,xe,Se),Ne=new WeakSet,Ve=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(ge),qe=(Le=new Uint32Array(1),t=>(Le[0]=t,Le[0]));var Le;const Fe=((t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),h=s.length;for(let t=o<0?-o:0;t+o<c&&t<h;t+=1)s[t]=u[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),h=s.length;for(let t=o<0?-o:0;t+o<c&&t<h;t+=1)u[t+o]=s[t]}})(qe,E),je=(t=>e=>{e.copyFromChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyToChannel)})(qe),Be=((t,e,n,s,i,r,o,a)=>{let c=null;return class u{constructor(u){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:l,sampleRate:p}={...M,...u};null===c&&(c=new i(1,1,44100));const d=null!==s&&e(r,r)?new s({length:h,numberOfChannels:l,sampleRate:p}):c.createBuffer(l,h,p);if(0===d.numberOfChannels)throw n();return"function"!=typeof d.copyFromChannel?(o(d),R(d)):e(O,(()=>O(d)))||a(d),t.add(d),d}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===u.prototype||t.has(e)}}})(Ne,fe,Xt,Ve,Ce,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0})(Ve),Fe,je),Ue=(t=>(e,n)=>{const s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)})(zt),ze=((t,e,n)=>async(s,i,r,o)=>{const a=e(s);await Promise.all(Array.from(a.activeInputs).map((async([e,s])=>{const a=t(e),c=await a.render(e,i,o);n(e)||c.connect(r,s)})))})(ye,q,tt),We=(t=>(e,n,s,i)=>t(n,e,s,i))(ze),Ge=((t,e,n,s,i,r,o,a,c,u,h)=>(l,p)=>{const d=l.createBufferSource();return Dt(d,p),Pt(d,p,"playbackRate"),Mt(d,p,"buffer"),Mt(d,p,"loop"),Mt(d,p,"loopEnd"),Mt(d,p,"loopStart"),e(n,(()=>n(l)))||(t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw Ct();e.call(t,s,i,r),n=!0}})(t.start)})(d),e(s,(()=>s(l)))||c(d),e(i,(()=>i(l)))||u(d,l),e(r,(()=>r(l)))||Nt(d),e(o,(()=>o(l)))||h(d,l),e(a,(()=>a(l)))||Vt(d),t(l,d),d})(Ue,fe,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),ie,re,oe,(t=>{t.start=(e=>(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)}),(t=>(e,n)=>{const s=n.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=s),t(e,"buffer",(t=>()=>{const n=t.call(e);return n===s?null:n}),(t=>n=>t.call(e,null===n?s:n)))})(ne),ae),He=((t,e)=>(n,s,i,r)=>(t(s).replay(i),e(s,n,i,r)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(q),ze),Xe=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u,h){const l=r.get(u);return void 0!==l?Promise.resolve(l):(async(c,u,h)=>{let l=n(c);const p=A(l,u);if(!p){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(u,t),null!==o&&l.start(...o),null!==a&&l.stop(a)}return r.set(u,l),p?await t(u,c.playbackRate,l.playbackRate,h):await s(u,c.playbackRate,l.playbackRate,h),await i(c,u,l,h),l})(c,u,h)}}})(We,Ge,J,He,we),Ye=((t,n,s,i,r,o,a,c,u,h,l,p,d)=>(f,m,_,g=null,v=null)=>{const y=new e.AutomationEventList(_.defaultValue),w=m?i(y):null,b={get defaultValue(){return _.defaultValue},get maxValue(){return null===g?_.maxValue:g},get minValue(){return null===v?_.minValue:v},get value(){return _.value},set value(t){_.value=t,b.setValueAtTime(t,f.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof _.cancelAndHoldAtTime)null===w&&y.flush(f.context.currentTime),y.add(r(t)),_.cancelAndHoldAtTime(t);else{const e=Array.from(y).pop();null===w&&y.flush(f.context.currentTime),y.add(r(t));const n=Array.from(y).pop();_.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?_.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?_.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?_.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&_.setValueCurveAtTime(n.values,n.startTime,n.duration))}return b},cancelScheduledValues:t=>(null===w&&y.flush(f.context.currentTime),y.add(o(t)),_.cancelScheduledValues(t),b),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===w&&y.flush(f.context.currentTime),y.add(a(t,e)),_.exponentialRampToValueAtTime(t,e),b},linearRampToValueAtTime:(t,e)=>(null===w&&y.flush(f.context.currentTime),y.add(c(t,e)),_.linearRampToValueAtTime(t,e),b),setTargetAtTime:(t,e,n)=>(null===w&&y.flush(f.context.currentTime),y.add(u(t,e,n)),_.setTargetAtTime(t,e,n),b),setValueAtTime:(t,e)=>(null===w&&y.flush(f.context.currentTime),y.add(h(t,e)),_.setValueAtTime(t,e),b),setValueCurveAtTime(t,e,n){const s=t instanceof Float32Array?t:new Float32Array(t);if(null!==p&&"webkitAudioContext"===p.name){const t=e+n,i=f.context.sampleRate,r=Math.ceil(e*i),o=Math.floor(t*i),a=o-r,c=new Float32Array(a);for(let t=0;t<a;t+=1){const o=(s.length-1)/n*((r+t)/i-e),a=Math.floor(o),u=Math.ceil(o);c[t]=a===u?s[a]:(1-(o-a))*s[a]+(1-(u-o))*s[u]}null===w&&y.flush(f.context.currentTime),y.add(l(c,e,n)),_.setValueCurveAtTime(c,e,n);const u=o/i;u<t&&d(b,c[c.length-1],u),d(b,s[s.length-1],t)}else null===w&&y.flush(f.context.currentTime),y.add(l(s,e,n)),_.setValueCurveAtTime(s,e,n);return b}};return s.set(b,_),n.set(b,f),t(b,w),b})(($e=o,(t,e)=>{$e.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),ke,a,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}})),e.createCancelAndHoldAutomationEvent,e.createCancelScheduledValuesAutomationEvent,e.createExponentialRampToValueAutomationEvent,e.createLinearRampToValueAutomationEvent,e.createSetTargetAutomationEvent,e.createSetValueAutomationEvent,e.createSetValueCurveAutomationEvent,Oe,se);var $e;const Ze=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),c={...N,...s},u=i(a,c),h=o(a),l=h?e():null;super(t,!1,u,l),this._audioBufferSourceNodeRenderer=l,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=u,this._onended=null,this._playbackRate=n(this,h,u.playbackRate,I,D)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){x(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),P(this)&&C(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(De,Xe,Ye,Ct,Ge,xe,Se,ce),Qe=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,n){const s=r(t),c=o(s),u=i(s,n,c);super(t,!1,u,c?e(a):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=u}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(De,(t=>{let e=null;return{render:(n,s,i)=>(null===e&&(e=(async(e,n,s)=>{const i=n.destination;return await t(e,n,i,s),i})(n,s,i)),e)}}),E,Ct,((t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(zt,ne),xe,Se,we),Je=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=A(u,a);if(!h){const t={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=e(a,t)}return r.set(a,u),h?(await t(a,o.Q,u.Q,c),await t(a,o.detune,u.detune,c),await t(a,o.frequency,u.frequency,c),await t(a,o.gain,u.gain,c)):(await s(a,o.Q,u.Q,c),await s(a,o.detune,u.detune,c),await s(a,o.frequency,u.frequency,c),await s(a,o.gain,u.gain,c)),await i(o,a,u,c),u})(o,a,c)}}})(We,Ft,J,He,we),Ke=(t=>(e,n)=>t.set(e,n))(pe),tn=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const c=r(t),u={...mt,...s},h=i(c,u),l=o(c);super(t,!1,h,l?n():null),this._Q=e(this,l,h.Q,I,D),this._detune=e(this,l,h.detune,1200*Math.log2(I),-1200*Math.log2(I)),this._frequency=e(this,l,h.frequency,t.sampleRate/2,0),this._gain=e(this,l,h.gain,40*Math.log10(I),D),this._nativeBiquadFilterNode=h,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw s();throw t}if(t.length!==e.length||e.length!==n.length)throw s()}})(De,Ye,Je,St,Ft,xe,Se,Ke),en=((t,e)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,c=0)=>{const u=0===r.size;if(e(o))return i.call(n,o,a,c),t(r,[o,a,c],(t=>t[0]===o&&t[1]===a&&t[2]===c),!0),u&&s(),o;i.call(n,o,a),t(r,[o,a],(t=>t[0]===o&&t[1]===a),!0),u&&s()})(n.connect),n.disconnect=(t=>(s,o,a)=>{const c=r.size>0;if(void 0===s)t.apply(n),r.clear();else if("number"==typeof s){t.call(n,s);for(const t of r)t[1]===s&&r.delete(t)}else{e(s)?t.call(n,s,o,a):t.call(n,s,o);for(const t of r)t[0]!==s||void 0!==o&&t[1]!==o||void 0!==a&&t[2]!==a||r.delete(t)}const u=0===r.size;c&&u&&i()})(n.disconnect),n})(z,Re),nn=((t,e)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(s,(()=>{const t=s.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(s,0,e)}),(()=>i.disconnect(s)))})(Ct,en),sn=((t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),Dt(i,s),i})(Oe,nn),rn=((t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={..._t,...r};super(t,!1,n(o,a),i(o)?e():null)}})(De,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!A(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(sn,J,we),sn,xe,Se),on=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=r({...gt,...o});super(t,!1,n(a,c),i(a)?e():null)}})(De,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!A(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(r,e)}return s.set(r,a),await n(i,r,a,o),a})(i,r,o)}}})(jt,J,we),jt,xe,Se,(t=>({...t,channelCount:t.numberOfOutputs}))),an=((t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=n(i,{...o,gain:r}),h=a.getChannelData(0);h[0]=1,h[1]=1,c.buffer=a,c.loop=!0;const l={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(t){c.onended=t},addEventListener:(...t)=>c.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>c.dispatchEvent(t[0]),removeEventListener:(...t)=>c.removeEventListener(t[0],t[1],t[2]),start(t=0){c.start.call(c,t)},stop(t=0){c.stop.call(c,t)}};return t(i,c),s(Bt(l,u),(()=>c.connect(u)),(()=>c.disconnect(u)))})(Ue,Ge,zt,en),cn=((t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Dt(a,o),Pt(a,o,"offset"),e(s,(()=>s(r)))||Nt(a),e(i,(()=>i(r)))||Vt(a),t(r,a),a})(Ue,fe,an,ie,oe),un=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...vt,...o},u=s(a,c),h=r(a),l=h?n():null;super(t,!1,u,l),this._constantSourceNodeRenderer=l,this._nativeConstantSourceNode=u,this._offset=e(this,h,u.offset,I,D),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){x(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),P(this)&&C(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(De,Ye,((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u,h){const l=r.get(u);return void 0!==l?Promise.resolve(l):(async(c,u,h)=>{let l=n(c);const p=A(l,u);if(!p){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(u,t),null!==o&&l.start(o),null!==a&&l.stop(a)}return r.set(u,l),p?await t(u,c.offset,l.offset,h):await s(u,c.offset,l.offset,h),await i(c,u,l,h),l})(c,u,h)}}})(We,cn,J,He,we),cn,xe,Se,ce),hn=((t,e)=>(n,s)=>{const i=n.createConvolver();if(Dt(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Mt(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i})(Xt,ne),ln=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c={...yt,...o},u=n(a,c);super(t,!1,u,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=u,null!==c.buffer&&r(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(De,((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!A(a,r)){const e={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(r,e)}return s.set(r,a),H(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(hn,J,we),hn,xe,Se,Ke),pn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),u={...wt,...a},h=s(c,u),l=r(c);super(t,!1,h,l?n(u.maxDelayTime):null),this._delayTime=e(this,l,h.delayTime),o(this,u.maxDelayTime)}get delayTime(){return this._delayTime}})(De,Ye,((t,e,n,s,i)=>r=>{const o=new WeakMap;return{render(a,c,u){const h=o.get(c);return void 0!==h?Promise.resolve(h):(async(a,c,u)=>{let h=n(a);const l=A(h,c);if(!l){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:r};h=e(c,t)}return o.set(c,h),l?await t(c,a.delayTime,h.delayTime,u):await s(c,a.delayTime,h.delayTime,u),await i(a,c,h,u),h})(a,c,u)}}})(We,Ut,J,He,we),Ut,xe,Se,Ke),dn=(t=>(e,n)=>{const s=e.createDynamicsCompressor();if(Dt(s,n),n.channelCount>2)throw t();if("max"===n.channelCountMode)throw t();return Pt(s,n,"attack"),Pt(s,n,"knee"),Pt(s,n,"ratio"),Pt(s,n,"release"),Pt(s,n,"threshold"),s})(Xt),fn=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const c=r(t),u={...xt,...i},h=s(c,u),l=o(c);super(t,!1,h,l?n():null),this._attack=e(this,l,h.attack),this._knee=e(this,l,h.knee),this._nativeDynamicsCompressorNode=h,this._ratio=e(this,l,h.ratio),this._release=e(this,l,h.release),this._threshold=e(this,l,h.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(De,Ye,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=A(u,a);if(!h){const t={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=e(a,t)}return r.set(a,u),h?(await t(a,o.attack,u.attack,c),await t(a,o.knee,u.knee,c),await t(a,o.ratio,u.ratio,c),await t(a,o.release,u.release,c),await t(a,o.threshold,u.threshold,c)):(await s(a,o.attack,u.attack,c),await s(a,o.knee,u.knee,c),await s(a,o.ratio,u.ratio,c),await s(a,o.release,u.release,c),await s(a,o.threshold,u.threshold,c)),await i(o,a,u,c),u})(o,a,c)}}})(We,dn,J,He,we),dn,Xt,xe,Se,Ke),mn=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...Tt,...o},u=s(a,c),h=r(a);super(t,!1,u,h?n():null),this._gain=e(this,h,u.gain,I,D)}get gain(){return this._gain}})(De,Ye,((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=A(u,a);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=e(a,t)}return r.set(a,u),h?await t(a,o.gain,u.gain,c):await s(a,o.gain,u.gain,c),await i(o,a,u,c),u})(o,a,c)}}})(We,zt,J,He,we),zt,xe,Se),_n=((t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:u,feedforward:h})=>{const l=qt(r,i.sampleRate),p=u instanceof Float64Array?u:new Float64Array(u),d=h instanceof Float64Array?h:new Float64Array(h),f=p.length,m=d.length,_=Math.min(f,m);if(0===f||f>20)throw s();if(0===p[0])throw e();if(0===m||m>20)throw s();if(0===d[0])throw e();if(1!==p[0]){for(let t=0;t<m;t+=1)d[t]/=p[0];for(let t=1;t<f;t+=1)p[t]/=p[0]}const g=n(i,l,o,o);g.channelCount=o,g.channelCountMode=a,g.channelInterpretation=c;const v=[],y=[],w=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),w.push(e)}g.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let t=0;t<s;t+=1){const s=e.getChannelData(t),i=n.getChannelData(t);v[t]=At(p,f,d,m,_,y[t],w[t],v[t],32,s,i)}};const b=i.sampleRate/2;return Bt({get bufferSize(){return l},get channelCount(){return g.channelCount},set channelCount(t){g.channelCount=t},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){g.channelCountMode=t},get channelInterpretation(){return g.channelInterpretation},set channelInterpretation(t){g.channelInterpretation=t},get context(){return g.context},get inputs(){return[g]},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},addEventListener:(...t)=>g.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>g.dispatchEvent(t[0]),getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/b),r=[Math.cos(i),Math.sin(i)],o=Wt(Gt(d,r),Gt(p,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>g.removeEventListener(t[0],t[1],t[2])},g)})(St,Ct,Ht,Xt),gn=((t,e,n,s)=>i=>t(Et,(()=>Et(i)))?Promise.resolve(t(s,s)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(fe,zt,Ht,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(zt,Ce)),vn=((t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const u=async(u,h,l)=>{let p=null,d=e(u);const f=A(d,h);if(void 0===h.createIIRFilter?p=t(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(d=h.createIIRFilter(o,r)),a.set(h,null===p?d:p),null!==p){if(null===c){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await s(u,t,t.destination,l);return((t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const u=new Float32Array(32),h=new Float32Array(32),l=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),p=t.numberOfChannels;for(let e=0;e<p;e+=1){const n=t.getChannelData(e),s=l.getChannelData(e);u.fill(0),h.fill(0),At(i,o,r,a,c,u,h,0,32,n,s)}return l})(await i(t),h,r,o)})()}const t=await c;return p.buffer=t,p.start(0),p}return await s(u,h,d,l),d};return{render(t,e,n){const s=a.get(e);return void 0!==s?Promise.resolve(s):u(t,e,n)}}})(Ge,J,Ce,we,gn),yn=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=i(a),u={...kt,...o},h=e(a,c?null:t.baseLatency,u);super(t,!1,h,c?n(u.feedback,u.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw St();return e.call(t,n,s,i)})})(h),this._nativeIIRFilterNode=h,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(De,(t=>(e,n,s)=>{if(void 0===e.createIIRFilter)return t(e,n,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Dt(i,s),i})(_n),vn,xe,Se,Ke),wn=((t,e,n,s,i)=>(r,o)=>{const a=o.listener,{forwardX:c,forwardY:u,forwardZ:h,positionX:l,positionY:p,positionZ:d,upX:f,upY:m,upZ:_}=void 0===a.forwardX?(()=>{const c=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),u=i(o),h=s(o,256,9,0),l=(e,s)=>{const i=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});return i.connect(c,0,e),i.start(),Object.defineProperty(i.offset,"defaultValue",{get:()=>s}),t({context:r},u,i.offset,I,D)};let p=[0,0,-1,0,1,0],d=[0,0,0];return h.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some(((t,e)=>t!==p[e]))&&(a.setOrientation(...e),p=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some(((t,e)=>t!==d[e]))&&(a.setPosition(...n),d=n)},c.connect(h),{forwardX:l(0,0),forwardY:l(1,0),forwardZ:l(2,-1),positionX:l(6,0),positionY:l(7,0),positionZ:l(8,0),upX:l(3,0),upY:l(4,1),upZ:l(5,0)}})():a;return{get forwardX(){return c},get forwardY(){return u},get forwardZ(){return h},get positionX(){return l},get positionY(){return p},get positionZ(){return d},get upX(){return f},get upY(){return m},get upZ(){return _}}})(Ye,sn,cn,Ht,Se),bn=new WeakMap,xn=((t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,c.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(Qe,wn,Ae,Se,bn,ce),Tn=((t,e,n,s,i,r)=>(o,a)=>{const c=o.createOscillator();return Dt(c,a),Pt(c,a,"detune"),Pt(c,a,"frequency"),void 0!==a.periodicWave?c.setPeriodicWave(a.periodicWave):Mt(c,a,"type"),e(n,(()=>n(o)))||Nt(c),e(s,(()=>s(o)))||r(c,o),e(i,(()=>i(o)))||Vt(c),t(o,c),c})(Ue,fe,ie,re,oe,ae),Cn=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){c=t},render(u,h,l){const p=r.get(h);return void 0!==p?Promise.resolve(p):(async(u,h,l)=>{let p=n(u);const d=A(p,h);if(!d){const t={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,detune:p.detune.value,frequency:p.frequency.value,periodicWave:null===o?void 0:o,type:p.type};p=e(h,t),null!==a&&p.start(a),null!==c&&p.stop(c)}return r.set(h,p),d?(await t(h,u.detune,p.detune,l),await t(h,u.frequency,p.frequency,l)):(await s(h,u.detune,p.detune,l),await s(h,u.frequency,p.frequency,l)),await i(u,h,p,l),p})(u,h,l)}}})(We,Tn,J,He,we),Sn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...$t,...o},u=n(a,c),h=r(a),l=h?s():null,p=t.sampleRate/2;super(t,!1,u,l),this._detune=e(this,h,u.detune,153600,-153600),this._frequency=e(this,h,u.frequency,p,-p),this._nativeOscillatorNode=u,this._onended=null,this._oscillatorNodeRenderer=l,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){x(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),P(this)&&C(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(De,Ye,Tn,Cn,xe,Se,ce),kn=(t=>(e,n)=>{const s=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}})(Ge),An=((t,e,n,s,i)=>(r,{curve:o,oversample:a,...c})=>{const u=r.createWaveShaper(),h=r.createWaveShaper();Dt(u,c),Dt(h,c);const l=n(r,{...c,gain:1}),p=n(r,{...c,gain:-1}),d=n(r,{...c,gain:1}),f=n(r,{...c,gain:-1});let m=null,_=!1,g=null;const v={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){l.channelCount=t,p.channelCount=t,u.channelCount=t,d.channelCount=t,h.channelCount=t,f.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){l.channelCountMode=t,p.channelCountMode=t,u.channelCountMode=t,d.channelCountMode=t,h.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){l.channelInterpretation=t,p.channelInterpretation=t,u.channelInterpretation=t,d.channelInterpretation=t,h.channelInterpretation=t,f.channelInterpretation=t},get context(){return u.context},get curve(){return g},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)u.curve=n,h.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,c=Math.floor(a),u=Math.ceil(a);e[o]=c===u?n[c]:(1-(a-c))*n[c]+(1-(u-a))*n[u],s[o]=c===u?-n[t-1-c]:-(1-(a-c))*n[t-1-c]-(1-(u-a))*n[t-1-u]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,u.curve=e,h.curve=s}g=n,_&&(s(g)&&null===m?m=t(r,l):null!==m&&(m(),m=null))},get inputs(){return[l]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get oversample(){return u.oversample},set oversample(t){u.oversample=t,h.oversample=t},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2])};null!==o&&(v.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==v.oversample&&(v.oversample=a);return i(Bt(v,d),(()=>{l.connect(u).connect(d),l.connect(p).connect(h).connect(f).connect(d),_=!0,s(g)&&(m=t(r,l))}),(()=>{l.disconnect(u),u.disconnect(d),l.disconnect(p),p.disconnect(h),h.disconnect(f),f.disconnect(d),_=!1,null!==m&&(m(),m=null)}))})(kn,Ct,zt,ee,en),On=((t,e,n,s,i,r,o)=>(a,c)=>{const u=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,c);Dt(u,c);const h=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==h&&h.length<2)throw e();Mt(u,{curve:h},"curve"),Mt(u,c,"oversample");let l=null,p=!1;o(u,"curve",(t=>()=>t.call(u)),(e=>n=>(e.call(u,n),p&&(s(n)&&null===l?l=t(a,u):s(n)||null===l||(l(),l=null)),n)));return i(u,(()=>{p=!0,s(u.curve)&&(l=t(a,u))}),(()=>{p=!1,null!==l&&(l(),l=null)}))})(kn,Ct,An,ee,en,Oe,ne),En=(t=>(e,n)=>{const s=e.createPanner();return void 0===s.orientationX?t(e,n):(Dt(s,n),Pt(s,n,"orientationX"),Pt(s,n,"orientationY"),Pt(s,n,"orientationZ"),Pt(s,n,"positionX"),Pt(s,n,"positionY"),Pt(s,n,"positionZ"),Mt(s,n,"coneInnerAngle"),Mt(s,n,"coneOuterAngle"),Mt(s,n,"coneOuterGain"),Mt(s,n,"distanceModel"),Mt(s,n,"maxDistance"),Mt(s,n,"panningModel"),Mt(s,n,"refDistance"),Mt(s,n,"rolloffFactor"),s)})(((t,e,n,s,i,r,o,a,c)=>(u,{coneInnerAngle:h,coneOuterAngle:l,coneOuterGain:p,distanceModel:d,maxDistance:f,orientationX:m,orientationY:_,orientationZ:g,panningModel:v,positionX:y,positionY:w,positionZ:b,refDistance:x,rolloffFactor:T,...C})=>{const S=u.createPanner();if(C.channelCount>2)throw o();if("max"===C.channelCountMode)throw o();Dt(S,C);const k={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=n(u,{...k,channelInterpretation:"speakers",numberOfInputs:6}),O=s(u,{...C,gain:1}),E=s(u,{...k,gain:1}),R=s(u,{...k,gain:0}),M=s(u,{...k,gain:0}),D=s(u,{...k,gain:0}),I=s(u,{...k,gain:0}),P=s(u,{...k,gain:0}),N=i(u,256,6,1),V=r(u,{...k,curve:new Float32Array([1,1]),oversample:"none"});let q=[m,_,g],L=[y,w,b];N.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some(((t,e)=>t!==q[e]))&&(S.setOrientation(...e),q=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some(((t,e)=>t!==L[e]))&&(S.setPosition(...n),L=n)},Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0});const F={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(t){if(t>2)throw o();O.channelCount=t,S.channelCount=t},get channelCountMode(){return S.channelCountMode},set channelCountMode(t){if("max"===t)throw o();O.channelCountMode=t,S.channelCountMode=t},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(t){O.channelInterpretation=t,S.channelInterpretation=t},get coneInnerAngle(){return S.coneInnerAngle},set coneInnerAngle(t){S.coneInnerAngle=t},get coneOuterAngle(){return S.coneOuterAngle},set coneOuterAngle(t){S.coneOuterAngle=t},get coneOuterGain(){return S.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();S.coneOuterGain=t},get context(){return S.context},get distanceModel(){return S.distanceModel},set distanceModel(t){S.distanceModel=t},get inputs(){return[O]},get maxDistance(){return S.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;S.maxDistance=t},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get orientationX(){return E.gain},get orientationY(){return R.gain},get orientationZ(){return M.gain},get panningModel(){return S.panningModel},set panningModel(t){S.panningModel=t},get positionX(){return D.gain},get positionY(){return I.gain},get positionZ(){return P.gain},get refDistance(){return S.refDistance},set refDistance(t){if(t<0)throw new RangeError;S.refDistance=t},get rolloffFactor(){return S.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;S.rolloffFactor=t},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])};h!==F.coneInnerAngle&&(F.coneInnerAngle=h),l!==F.coneOuterAngle&&(F.coneOuterAngle=l),p!==F.coneOuterGain&&(F.coneOuterGain=p),d!==F.distanceModel&&(F.distanceModel=d),f!==F.maxDistance&&(F.maxDistance=f),m!==F.orientationX.value&&(F.orientationX.value=m),_!==F.orientationY.value&&(F.orientationY.value=_),g!==F.orientationZ.value&&(F.orientationZ.value=g),v!==F.panningModel&&(F.panningModel=v),y!==F.positionX.value&&(F.positionX.value=y),w!==F.positionY.value&&(F.positionY.value=w),b!==F.positionZ.value&&(F.positionZ.value=b),x!==F.refDistance&&(F.refDistance=x),T!==F.rolloffFactor&&(F.rolloffFactor=T),1===q[0]&&0===q[1]&&0===q[2]||S.setOrientation(...q),0===L[0]&&0===L[1]&&0===L[2]||S.setPosition(...L);return c(Bt(F,S),(()=>{O.connect(S),t(O,V,0,0),V.connect(E).connect(A,0,0),V.connect(R).connect(A,0,1),V.connect(M).connect(A,0,2),V.connect(D).connect(A,0,3),V.connect(I).connect(A,0,4),V.connect(P).connect(A,0,5),A.connect(N).connect(u.destination)}),(()=>{O.disconnect(S),a(O,V,0,0),V.disconnect(E),E.disconnect(A),V.disconnect(R),R.disconnect(A),V.disconnect(M),M.disconnect(A),V.disconnect(D),D.disconnect(A),V.disconnect(I),I.disconnect(A),V.disconnect(P),P.disconnect(A),A.disconnect(N),N.disconnect(u.destination)}))})(X,Ct,sn,zt,Ht,On,Xt,Q,en)),Rn=((t,e,n,s,i,r,o,a,c,u)=>()=>{const h=new WeakMap;let l=null;return{render(p,d,f){const m=h.get(d);return void 0!==m?Promise.resolve(m):(async(p,d,f)=>{let m=null,_=r(p);const g={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},v={...g,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},y=A(_,d);if("bufferSize"in _)m=s(d,{...g,gain:1});else if(!y){const t={...v,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(d,t)}if(h.set(d,null===m?_:m),null!==m){if(null===l){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,p.context.length,d.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),l=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset,f),i})));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return u(t)})()}const t=await l,r=s(d,{...g,gain:1});await c(p,d,r,f);const h=[];for(let e=0;e<t.numberOfChannels;e+=1)h.push(t.getChannelData(e));let _=[h[0][0],h[1][0],h[2][0]],y=[h[3][0],h[4][0],h[5][0]],w=s(d,{...g,gain:1}),b=i(d,{...v,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:y[0],positionY:y[1],positionZ:y[2]});r.connect(w).connect(b.inputs[0]),b.connect(m);for(let e=128;e<t.length;e+=128){const t=[h[0][e],h[1][e],h[2][e]],n=[h[3][e],h[4][e],h[5][e]];if(t.some(((t,e)=>t!==_[e]))||n.some(((t,e)=>t!==y[e]))){_=t,y=n;const o=e/d.sampleRate;w.gain.setValueAtTime(0,o),w=s(d,{...g,gain:0}),b=i(d,{...v,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:y[0],positionY:y[1],positionZ:y[2]}),w.gain.setValueAtTime(1,o),r.connect(w).connect(b.inputs[0]),b.connect(m)}}return m}return y?(await t(d,p.orientationX,_.orientationX,f),await t(d,p.orientationY,_.orientationY,f),await t(d,p.orientationZ,_.orientationZ,f),await t(d,p.positionX,_.positionX,f),await t(d,p.positionY,_.positionY,f),await t(d,p.positionZ,_.positionZ,f)):(await a(d,p.orientationX,_.orientationX,f),await a(d,p.orientationY,_.orientationY,f),await a(d,p.orientationZ,_.orientationZ,f),await a(d,p.positionX,_.positionX,f),await a(d,p.positionY,_.positionY,f),await a(d,p.positionZ,_.positionZ,f)),H(_)?await c(p,d,_.inputs[0],f):await c(p,d,_,f),_})(p,d,f)}}})(We,sn,cn,zt,En,J,Ce,He,we,gn),Mn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),u={...Zt,...a},h=n(c,u),l=r(c);super(t,!1,h,l?s():null),this._nativePannerNode=h,this._orientationX=e(this,l,h.orientationX,I,D),this._orientationY=e(this,l,h.orientationY,I,D),this._orientationZ=e(this,l,h.orientationZ,I,D),this._positionX=e(this,l,h.positionX,I,D),this._positionY=e(this,l,h.positionY,I,D),this._positionZ=e(this,l,h.positionZ,I,D),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(De,Ye,En,Rn,xe,Se,Ke),Dn=((t,e,n,s)=>class i{constructor(i,r){const o=e(i),a=s({...Qt,...r}),c=t(o,a);return n.add(c),c}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}})((t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a})(E),xe,new WeakSet,(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})),In=((t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return Dt(r,s),Pt(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r})(((t,e,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),c=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},h={...u,oversample:"none"},l=(t,r,l,p,d)=>{if(1===r)return((t,e,i,r)=>{const l=new Float32Array(o),p=new Float32Array(o);for(let t=0;t<o;t+=1){const e=t/16384*c;l[t]=Math.cos(e),p[t]=Math.sin(e)}const d=n(t,{...u,gain:0}),f=s(t,{...h,curve:l}),m=s(t,{...h,curve:a}),_=n(t,{...u,gain:0}),g=s(t,{...h,curve:p});return{connectGraph(){e.connect(d),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(_),m.connect(i),i.connect(void 0===f.inputs?f:f.inputs[0]),i.connect(void 0===g.inputs?g:g.inputs[0]),f.connect(d.gain),g.connect(_.gain),d.connect(r,0,0),_.connect(r,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(_),m.disconnect(i),i.disconnect(void 0===f.inputs?f:f.inputs[0]),i.disconnect(void 0===g.inputs?g:g.inputs[0]),f.disconnect(d.gain),g.disconnect(_.gain),d.disconnect(r,0,0),_.disconnect(r,0,1)}}})(t,l,p,d);if(2===r)return((t,i,r,l)=>{const p=new Float32Array(o),d=new Float32Array(o),f=new Float32Array(o),m=new Float32Array(o),_=Math.floor(8192.5);for(let t=0;t<o;t+=1)if(t>_){const e=(t-_)/(16384-_)*c;p[t]=Math.cos(e),d[t]=Math.sin(e),f[t]=0,m[t]=1}else{const e=t/(16384-_)*c;p[t]=1,d[t]=0,f[t]=Math.cos(e),m[t]=Math.sin(e)}const g=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(t,{...u,gain:0}),y=s(t,{...h,curve:p}),w=n(t,{...u,gain:0}),b=s(t,{...h,curve:d}),x=s(t,{...h,curve:a}),T=n(t,{...u,gain:0}),C=s(t,{...h,curve:f}),S=n(t,{...u,gain:0}),k=s(t,{...h,curve:m});return{connectGraph(){i.connect(g),i.connect(void 0===x.inputs?x:x.inputs[0]),g.connect(v,0),g.connect(w,0),g.connect(T,1),g.connect(S,1),x.connect(r),r.connect(void 0===y.inputs?y:y.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===C.inputs?C:C.inputs[0]),r.connect(void 0===k.inputs?k:k.inputs[0]),y.connect(v.gain),b.connect(w.gain),C.connect(T.gain),k.connect(S.gain),v.connect(l,0,0),T.connect(l,0,0),w.connect(l,0,1),S.connect(l,0,1)},disconnectGraph(){i.disconnect(g),i.disconnect(void 0===x.inputs?x:x.inputs[0]),g.disconnect(v,0),g.disconnect(w,0),g.disconnect(T,1),g.disconnect(S,1),x.disconnect(r),r.disconnect(void 0===y.inputs?y:y.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===C.inputs?C:C.inputs[0]),r.disconnect(void 0===k.inputs?k:k.inputs[0]),y.disconnect(v.gain),b.disconnect(w.gain),C.disconnect(T.gain),k.disconnect(S.gain),v.disconnect(l,0,0),T.disconnect(l,0,0),w.disconnect(l,0,1),S.disconnect(l,0,1)}}})(t,l,p,d);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...c})=>{if("max"===o)throw i();const u=t(e,{...c,channelCount:1,channelCountMode:o,numberOfInputs:2}),h=n(e,{...c,channelCount:s,channelCountMode:o,gain:1}),p=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:f}=l(e,s,h,p,u);Object.defineProperty(p.gain,"defaultValue",{get:()=>0}),Object.defineProperty(p.gain,"maxValue",{get:()=>1}),Object.defineProperty(p.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){h.channelCount!==t&&(_&&f(),({connectGraph:d,disconnectGraph:f}=l(e,t,h,p,u)),_&&d()),h.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();h.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t},get context(){return h.context},get inputs(){return[h]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get pan(){return p.gain},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};let _=!1;return r(Bt(m,u),(()=>{d(),_=!0}),(()=>{f(),_=!1}))}})(sn,jt,zt,On,Xt,en),Xt),Pn=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a,c){const u=r.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=A(u,a);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=e(a,t)}return r.set(a,u),h?await t(a,o.pan,u.pan,c):await s(a,o.pan,u.pan,c),H(u)?await i(o,a,u.inputs[0],c):await i(o,a,u,c),u})(o,a,c)}}})(We,In,J,He,we),Nn=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...Jt,...o},u=n(a,c),h=r(a);super(t,!1,u,h?s():null),this._pan=e(this,h,u.pan)}get pan(){return this._pan}})(De,Ye,In,Pn,xe,Se),Vn=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r,o){const a=s.get(r);return void 0!==a?Promise.resolve(a):(async(i,r,o)=>{let a=e(i);if(!A(a,r)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(r,e)}return s.set(r,a),H(a)?await n(i,r,a.inputs[0],o):await n(i,r,a,o),a})(i,r,o)}}})(On,J,we),qn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),c={...te,...e},u=n(a,c);super(t,!0,u,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=u,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(De,Ct,On,Vn,xe,Se,Ke),Ln=(t=>null!==t&&t.isSecureContext)(ge),Fn=(t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(ge),jn=new WeakMap,Bn=((t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,8e3),t.set(n,s),s})(jn,Ce),Un=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(ge),zn=Ln?((t,e,n,s,i,r,o,a,c,u,h,p)=>(d,f,v={credentials:"omit"})=>{const y=r(d);if(void 0!==y.audioWorklet)return Promise.all([i(f),Promise.resolve(t(h,h))]).then((([[t,e],n])=>{const[s,i]=m(t,e),r=n?i:i.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),c=new Blob([`${s};(registerProcessor=>{${r}\n})((n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(c);return y.audioWorklet.addModule(u,v).then((()=>{if(a(y))return;return o(y).audioWorklet.addModule(u,v)})).finally((()=>URL.revokeObjectURL(u)))}));const w=u.get(d);if(void 0!==w&&w.has(f))return Promise.resolve();const b=c.get(d);if(void 0!==b){const t=b.get(f);if(void 0!==t)return t}const x=i(f).then((([t,e])=>{const[s,i]=m(t,e);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=p._AWGS.pop();if(void 0===t)throw new SyntaxError;s(y.currentTime,y.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const s=l.get(y);if(void 0!==s){if(s.has(t))throw e();g(n),_(n.parameterDescriptors),s.set(t,n)}else g(n),_(n.parameterDescriptors),l.set(y,new Map([[t,n]]))}),y.sampleRate,void 0,void 0)))}));return void 0===b?c.set(d,new Map([[f,x]])):b.set(f,x),x.then((()=>{const t=u.get(d);void 0===t?u.set(d,new Set([f])):t.add(f)})).finally((()=>{const t=c.get(d);void 0!==t&&t.delete(f)})),x})(fe,Xt,(t=>e=>new Promise(((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,u=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(u(),s(o),!1):null!==c?c(e,n,i,r,o):void 0,r.onerror=()=>{u(),s(new SyntaxError)},r.onload=()=>{u(),n()},r.src=a,r.type="module",i.appendChild(r)}})))(ge),Fn,(t=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw t()})((()=>new DOMException("","AbortError"))),xe,Bn,Se,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,8e3),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),await s.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(Un,Ce),ge):void 0,Wn=((t,e)=>n=>t(n)||e(n))(Ee,Se),Gn=((t,e,n,s,i,r,o,a,c,u,h)=>(l,p)=>{const d=o(l)?l:r(l);if(i.has(p)){const t=n();return Promise.reject(t)}try{i.add(p)}catch{}return e(c,(()=>c(d)))?d.decodeAudioData(p).then((n=>(e(a,(()=>a(n)))||h(n),t.add(n),n))):new Promise(((e,n)=>{const i=()=>{try{(t=>{const{port1:e}=new MessageChannel;e.postMessage(t,[t])})(p)}catch{}},r=t=>{n(t),i()};try{d.decodeAudioData(p,(n=>{"function"!=typeof n.copyFromChannel&&(u(n),R(n)),t.add(n),i(),e(n)}),(t=>{r(null===t?s():t)}))}catch(t){r(t)}}))})(Ne,fe,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,xe,Wn,O,Et,Fe,je),Hn=((t,e,n,s,i,r,o,a,c,u,h,l,p,d,f,m,_,g,v,y)=>class extends f{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,s){return new n({length:e,numberOfChannels:t,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(t=6){return new r(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(t=1){return new h(this,{maxDelayTime:t})}createDynamicsCompressor(){return new l(this)}createGain(){return new p(this)}createIIRFilter(t,e){return new d(this,{feedback:e,feedforward:t})}createOscillator(){return new m(this)}createPanner(){return new _(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new g(this,{...n,imag:e,real:t})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,n){return u(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t))).catch((t=>{throw"function"==typeof n&&n(t),t}))}})(zn,Pe,Be,Ze,tn,rn,on,un,ln,Gn,pn,fn,mn,yn,xn,Sn,Mn,Dn,Nn,qn),Xn=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(De,((t,e)=>t.createMediaElementSource(e.mediaElement)),xe,Se),Yn=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t);if(s(r))throw new TypeError;const o={...Ot,...i},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(De,((t,e)=>{const n=t.createMediaStreamDestination();return Dt(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),xe,Se),$n=((t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(De,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i}),xe,Se),Zn=((t,e,n)=>class extends t{constructor(t,s){const i=n(t);super(t,!0,e(i,s),null)}})(De,((t,e)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r})(Ct,Se),xe),Qn=((t,e,n,s,i,r,o,a,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");const e=new c(t);if(null===e)throw s();if(!j(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),F(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(Hn,Ct,Xt,Kt,Xn,Yn,$n,Zn,Oe),Jn=(t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(bn),Kn=(t=>(e,n)=>{t(e).add(n)})(Jn),ts=(t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return it(n)?r.connect(n,0,i):r.connect(n,0)})(E),es=(t=>(e,n)=>{t(e).delete(n)})(Jn),ns=(t=>(e,n,s,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?bt(t,e,n).disconnect():it(n)?void 0===s?e.forEach((t=>t.disconnect(n))):void 0===i?bt(t,e,s).disconnect(n,0):bt(t,e,s).disconnect(n,0,i):void 0===s?e.forEach((t=>t.disconnect(n))):bt(t,e,s).disconnect(n,0))(E),ss=new WeakMap,is=((t,e)=>n=>e(t,n))(ss,v),rs=((t,e,n,s,i,r,o,a,c,u,h,l,d)=>(f,m,_,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw c();const v=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(v.some((t=>t<1)))throw c();if(v.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw c();const y=g.channelCount*g.numberOfInputs,w=v.reduce(((t,e)=>t+e),0),b=void 0===_.parameterDescriptors?0:_.parameterDescriptors.length;if(y+b>6||w>6)throw c();const x=new MessageChannel,T=[],C=[];for(let t=0;t<g.numberOfInputs;t+=1)T.push(o(f,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),C.push(i(f,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const S=[];if(void 0!==_.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of _.parameterDescriptors){const i=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?I:e},minValue:{get:()=>void 0===n?D:n}}),S.push(i)}const k=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+b)}),A=qt(m,f.sampleRate),O=a(f,A,y+b,Math.max(1,w)),E=i(f,{channelCount:Math.max(1,w),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,w)}),R=[];for(let t=0;t<g.numberOfOutputs;t+=1)R.push(s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[t]}));for(let t=0;t<g.numberOfInputs;t+=1){T[t].connect(C[t]);for(let e=0;e<g.channelCount;e+=1)C[t].connect(k,e,t*g.channelCount+e)}const M=new ut(void 0===_.parameterDescriptors?[]:_.parameterDescriptors.map((({name:t},e)=>{const n=S[e];return n.connect(k,0,y+e),n.start(0),[t,n.offset]})));k.connect(O);let P=g.channelInterpretation,N=null;const V=0===g.numberOfOutputs?[O]:R,q={get bufferSize(){return A},get channelCount(){return g.channelCount},set channelCount(t){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return P},set channelInterpretation(t){for(const e of T)e.channelInterpretation=t;P=t},get context(){return O.context},get inputs(){return T},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return N},set onprocessorerror(t){"function"==typeof N&&q.removeEventListener("processorerror",N),N="function"==typeof t?t:null,"function"==typeof N&&q.addEventListener("processorerror",N)},get parameters(){return M},get port(){return x.port2},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,V),disconnect:u.bind(null,V),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])},L=new Map;var F,j;x.port1.addEventListener=(F=x.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=L.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{h(f.currentTime,f.sampleRate,(()=>e(t)))},L.set(e,t[1]))}}return F.call(x.port1,t[0],t[1],t[2])}),x.port1.removeEventListener=(j=x.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=L.get(t[1]);void 0!==e&&(L.delete(t[1]),t[1]=e)}return j.call(x.port1,t[0],t[1],t[2])});let B=null;Object.defineProperty(x.port1,"onmessage",{get:()=>B,set:t=>{"function"==typeof B&&x.port1.removeEventListener("message",B),B="function"==typeof t?t:null,"function"==typeof B&&(x.port1.addEventListener("message",B),x.port1.start())}}),_.prototype.port=x.port1;let U=null;((t,e,n,s)=>{let i=p.get(t);void 0===i&&(i=new WeakMap,p.set(t,i));const r=Lt(n,s);return i.set(e,r),r})(f,q,_,g).then((t=>U=t));const z=dt(g.numberOfInputs,g.channelCount),W=dt(g.numberOfOutputs,v),G=void 0===_.parameterDescriptors?[]:_.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let H=!0;const X=()=>{g.numberOfOutputs>0&&O.disconnect(E);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=R[t];for(let s=0;s<v[t];s+=1)E.disconnect(n,e+s,s);e+=v[t]}},Y=new Map;O.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==U){const n=l(q);for(let s=0;s<A;s+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let n=0;n<g.channelCount;n+=1)lt(t,z[e],n,n,s);void 0!==_.parameterDescriptors&&_.parameterDescriptors.forEach((({name:e},n)=>{lt(t,G,e,y+n,s)}));for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<v[t];e+=1)0===W[t][e].byteLength&&(W[t][e]=new Float32Array(128));try{const t=z.map(((t,e)=>{if(n[e].size>0)return Y.set(e,A/128),t;const s=Y.get(e);return void 0===s?[]:(t.every((t=>t.every((t=>0===t))))&&(1===s?Y.delete(e):Y.set(e,s-1)),t)})),i=h(f.currentTime+s/f.sampleRate,f.sampleRate,(()=>U.process(t,W,G)));H=i;for(let t=0,n=0;t<g.numberOfOutputs;t+=1){for(let i=0;i<v[t];i+=1)pt(e,W[t],i,n+i,s);n+=v[t]}}catch(t){H=!1,q.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!H){for(let t=0;t<g.numberOfInputs;t+=1){T[t].disconnect(C[t]);for(let e=0;e<g.channelCount;e+=1)C[s].disconnect(k,e,t*g.channelCount+e)}if(void 0!==_.parameterDescriptors){const t=_.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=S[e];t.disconnect(k,0,y+e),t.stop()}}k.disconnect(O),O.onaudioprocess=null,$?X():J();break}}}};let $=!1;const Z=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Q=()=>O.connect(Z).connect(f.destination),J=()=>{O.disconnect(Z),Z.disconnect()};return Q(),d(q,(()=>{if(H){J(),g.numberOfOutputs>0&&O.connect(E);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=R[t];for(let s=0;s<v[t];s+=1)E.connect(n,e+s,s);e+=v[t]}}$=!0}),(()=>{H&&(Q(),X()),$=!1}))})(ts,E,Ct,sn,jt,cn,zt,Ht,Xt,ns,Fn,is,en),os=((t,e,n,s,i)=>(r,o,a,c,u,h)=>{if(null!==a)try{const e=new a(r,c,h),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>h.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(p=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=s.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},s.set(e,t[1]))}}return p.call(e,"error",t[1],t[2]),p.call(e,...t)}),e.removeEventListener=(l=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=s.get(t[1]);void 0!==e&&(s.delete(t[1]),t[1]=e)}return l.call(e,"error",t[1],t[2]),l.call(e,t[0],t[1],t[2])}),0!==h.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return i(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(t){if(11===t.code)throw s();throw t}var l,p;if(void 0===u)throw s();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(h),e(r,o,u,h)})(Ct,rs,zt,Xt,en),as=((t,e,n,s,i,r,o,a,c,u,h,l,p,d,f,m)=>(_,g,v)=>{const y=new WeakMap;let w=null;return{render(b,x,T){a(x,b);const C=y.get(x);return void 0!==C?Promise.resolve(C):(async(a,b,x)=>{let T=h(a),C=null;const S=A(T,b),k=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(null===l){const t=k.reduce(((t,e)=>t+e),0),n=i(b,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:k[t]}));const u=o(b,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1});u.connect=e.bind(null,r),u.disconnect=c.bind(null,r),C=[n,r,u]}else S||(T=new l(b,_));if(y.set(b,null===C?T:C[2]),null!==C){if(null===w){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=t+e,c=async()=>{const c=new p(n,128*Math.ceil(a.context.length/128),b.sampleRate),u=[],h=[];for(let t=0;t<g.numberOfInputs;t+=1)u.push(o(c,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),h.push(i(c,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const l=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(c,t,e.offset,x),e}))),_=s(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<g.numberOfInputs;t+=1){u[t].connect(h[t]);for(let e=0;e<g.channelCount;e+=1)h[t].connect(_,e,t*g.channelCount+e)}for(const[e,n]of l.entries())n.connect(_,0,t+e),n.start(0);return _.connect(c.destination),await Promise.all(u.map((t=>f(a,c,t,x)))),m(c)};w=ft(a,0===n?null:await c(),b,g,k,v,u)}const t=await w,e=n(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,h,l]=C;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=h[t];for(let s=0;s<k[t];s+=1)c.connect(n,e+s,s);e+=k[t]}return l}if(S)for(const[e,n]of a.parameters.entries())await t(b,n,T.parameters.get(e),x);else for(const[t,e]of a.parameters.entries())await d(b,e,T.parameters.get(t),x);return await f(a,b,T,x),T})(b,x,T)}}})(We,ts,Ge,sn,jt,cn,zt,es,ns,Fn,J,Un,Ce,He,we,gn),cs=(t=>e=>t.get(e))(jn),us=(t=>(e,n)=>{t.set(e,n)})(ss),hs=Ln?((t,e,n,s,i,r,o,a,c,u,h,p,d)=>class extends e{constructor(e,d,f){var m;const _=a(e),g=c(_),v=h({...ht,...f}),y=l.get(_),w=null==y?void 0:y.get(d),b=g||"closed"!==_.state?_:null!==(m=o(_))&&void 0!==m?m:_,x=i(b,g?null:e.baseLatency,u,d,w,v);super(e,!0,x,g?s(d,v,w):null);const T=[];x.parameters.forEach(((t,e)=>{const s=n(this,g,t);T.push([e,s])})),this._nativeAudioWorkletNode=x,this._onprocessorerror=null,this._parameters=new ut(T),g&&t(_,this);const{activeInputs:C}=r(this);p(x,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Kn,De,Ye,as,os,V,cs,xe,Se,Un,(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),us,ce):void 0,ls=(((t,e,n,s,i)=>{})(Ct,Xt,Kt,xn,Oe),((t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(Xt,Ce)),ds=((t,e,n,s,i,r,o,a)=>{const c=[];return(u,h)=>n(u).render(u,h,c).then((()=>Promise.all(Array.from(s(h)).map((t=>n(t).render(t,h,c)))))).then((()=>i(h))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),R(n)):e(r,(()=>r(n)))||a(n),t.add(n),n)))})(Ne,fe,ye,Jn,gn,O,Fe,je),fs=(((t,e,n,s,i)=>{})(fe,Ct,ls,xn,ds),((t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"==typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:c}={...Yt,...r},u=s(a,o,c);e(Et,(()=>Et(u)))||u.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(u.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(u,a),this._length=o,this._nativeOfflineAudioContext=u,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,F(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(Hn,fe,Ct,ls,ds)),ms=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(c,Ee),_s=((t,e)=>n=>t.has(n)||e(n))(r,Re),gs=((t,e)=>n=>t.has(n)||e(n))(a,Me),vs=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(c,Se);function ys(t,e){if(!t)throw new Error(e)}function ws(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function bs(t){t.isOffline||"running"===t.state||Ts('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let xs=console;function Ts(...t){xs.warn(...t)}function Cs(t){return void 0===t}function Ss(t){return!Cs(t)}function ks(t){return"number"==typeof t}function As(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Os(t){return Array.isArray(t)}function Es(t){return"string"==typeof t}function Rs(t){return Es(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const Ms="object"==typeof self?self:null,Ds=Ms&&(Ms.hasOwnProperty("AudioContext")||Ms.hasOwnProperty("webkitAudioContext"));function Is(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function Ps(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}Object.create;Object.create;class Ns{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Vs(t){return gs(t)}function qs(t){return _s(t)}function Ls(t){return vs(t)}function Fs(t){return ms(t)}function js(t){return t instanceof Be}function Bs(t,e){return"value"===t||Vs(e)||qs(e)||js(e)}function Us(t,...e){if(!e.length)return t;const n=e.shift();if(As(t)&&As(n))for(const e in n)Bs(e,n[e])?t[e]=n[e]:As(n[e])?(t[e]||Object.assign(t,{[e]:{}}),Us(t[e],n[e])):Object.assign(t,{[e]:n[e]});return Us(t,...e)}function zs(t,e,n=[],s){const i={},r=Array.from(e);if(As(r[0])&&s&&!Reflect.has(r[0],s)){Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(Us(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&As(r[0]))Us(i,r[0]);else for(let t=0;t<n.length;t++)Ss(r[t])&&(i[n[t]]=r[t]);return Us(t,i)}function Ws(t,e){return Cs(t)?e:t}function Gs(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}class Hs{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Ms&&this.toString()===Ms.TONE_DEBUG_CLASS)&&function(...t){xs.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Hs.version=t;const Xs=1e-6;function Ys(t,e){return t>e+Xs}function $s(t,e){return Ys(t,e)||Qs(t,e)}function Zs(t,e){return t+Xs<e}function Qs(t,e){return Math.abs(t-e)<Xs}class Js extends Hs{constructor(){super(),this.name="Timeline",this._timeline=[];const t=zs(Js.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(ys(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];ys($s(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(Qs(this._timeline[e].time,t)){for(let n=e;n>=0&&Qs(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&$s(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(Qs(r[e],t)){for(let n=s;n<this._timeline.length;n++){if(!Qs(this._timeline[n][e],t))break;s=n}return s}if(Zs(r[e],t)&&Ys(o[e],t))return s;Ys(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&Qs(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0&&Qs(this._timeline[e].time,t);e--)s=e;this._iterate((t=>{e(t)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Ks=[];function ti(t){Ks.push(t)}const ei=[];function ni(t){ei.push(t)}class si extends Hs{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Cs(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((t=>{if(Cs(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Cs(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(si.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class ii extends si{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class ri extends ii{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Js,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=zs(ri.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new Qn(t)}({latencyHint:t.latencyHint}),this._ticker=new Ns(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,Ks.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){ys(Fs(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){ys(Fs(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){ys(Fs(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){ys(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){ys(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){ys(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){ys(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return ys(Ss(hs),"This node only works in a secure context (https or localhost)"),new hs(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return Ps(this,void 0,void 0,(function*(){ys(Ss(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return Ps(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Es(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return Fs(this._context)?this._context.resume():Promise.resolve()}close(){return Ps(this,void 0,void 0,(function*(){var t;Fs(this._context)&&(yield this._context.close()),this._initialized&&(t=this,ei.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}function oi(t,e){Os(e)?e.forEach((e=>oi(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function ai(t,e){Os(e)?e.forEach((e=>ai(t,e))):Object.defineProperty(t,e,{writable:!0})}const ci=()=>{};class ui extends Hs{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ci;const t=zs(ui.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&js(t.url)||t.url instanceof ui?this.set(t.url):Es(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:ci,onload:ci,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:di().sampleRate}set(t){return t instanceof ui?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Ps(this,void 0,void 0,(function*(){const e=ui.load(t).then((t=>{this.set(t),this.onload(this)}));ui.downloads.push(e);try{yield e}finally{const t=ui.downloads.indexOf(e);ui.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Os(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=di(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(ks(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(ks(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);ys(n<s,"The start time must be less than the end time");const i=s-n,r=di().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,s),t);return new ui(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new ui).fromArray(t)}static fromUrl(t){return Ps(this,void 0,void 0,(function*(){const e=new ui;return yield e.load(t)}))}static load(t){return Ps(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if(ui.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===ui.baseUrl||ui.baseUrl.endsWith("/")?ui.baseUrl:ui.baseUrl+"/",s=yield fetch(n+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const i=yield s.arrayBuffer();return yield di().decodeAudioData(i)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Ps(this,void 0,void 0,(function*(){for(yield Promise.resolve();ui.downloads.length;)yield ui.downloads[0]}))}}ui.baseUrl="",ui.downloads=[];class hi extends ri{constructor(){var t,e,n;super({clockSource:"offline",context:Ls(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new fs(t,e,n)),lookAhead:0,updateInterval:Ls(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ls(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Ps(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return Ps(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new ui(e)}))}close(){return Promise.resolve()}}const li=new class extends ii{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return Ps(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let pi=li;function di(){return pi===li&&Ds&&fi(new ri),pi}function fi(t){pi=Fs(t)?new ri(t):Ls(t)?new hi(t):t}function mi(){return pi.resume()}if(Ms&&!Ms.TONE_SILENCE_LOGGING){let t="v";0;const e=` * Tone.js ${t}14.8.9 * `;console.log(`%c${e}`,"background: #000; color: #fff")}function _i(t){return Math.log(t)/Math.LN10*20}function gi(t){return Math.pow(2,t/12)}let vi=440;function yi(t){return Math.round(wi(t))}function wi(t){return 69+12*Math.log2(t/vi)}function bi(t){return vi*Math.pow(2,(t-69)/12)}class xi extends Hs{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof xi&&this.fromType(this._val),Cs(this._val))return this._noArg();if(Es(this._val)&&Cs(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(As(this._val)){let t=0;for(const e in this._val)if(Ss(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Ss(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Es(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Ti extends xi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Ti(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],s=new Ti(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Ti(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,e,s].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return yi(this.toFrequency())}_now(){return this.context.now()}}class Ci extends Ti{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return vi}static set A4(t){!function(t){vi=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Ci.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Si[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:Ci.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new Ci(this.context,this.valueOf()*gi(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return yi(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Ci.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return ki[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return bi(t)}static ftom(t){return yi(t)}}const Si={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},ki=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ai extends Ti{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Oi extends Hs{constructor(){super();const t=zs(Oi.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:di()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Ti(this.context,t).toSeconds()}toFrequency(t){return new Ci(this.context,t).toFrequency()}toTicks(t){return new Ai(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Cs(t[n])&&delete e[n]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];Ss(n)&&Ss(n.value)&&Ss(n.setValueAtTime)?t[e]=n.value:n instanceof Oi?t[e]=n._getPartialProperties(t[e]):Os(n)||ks(n)||Es(n)||"boolean"==typeof n?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Ss(this[e])&&(this[e]&&Ss(this[e].value)&&Ss(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof Oi?this[e].set(t[e]):this[e]=t[e])})),this}}class Ei extends Js{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return ws(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}}class Ri extends Oi{constructor(){super(zs(Ri.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=zs(Ri.getDefaults(),arguments,["param","units","convert"]);for(ys(Ss(t.param)&&(Vs(t.param)||t.param instanceof Ri),"param must be an AudioParam");!Vs(t.param);)t.param=t.param._param;this._swappable=!!Ss(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Js(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Ss(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Oi.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Ss(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Ss(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Ss(this.maxValue)&&Ss(this.minValue)&&ws(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?_i(t):t}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return ys(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return ys(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=Qs(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return ys(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);ys(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),ys(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const i=this._fromType(t[n])*s;this.linearRampToValueAtTime(this._toType(i),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return ys(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));ys(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&Qs(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){ys(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class Mi extends Oi{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Ss(this.input)?Vs(this.input)||this.input instanceof Ri?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ss(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Ss(t)&&(t instanceof Mi||qs(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();ys(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return Ii(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Ts("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return Pi(this,t,e,n),this}chain(...t){return Di(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Ss(this.input)&&(this.input instanceof Mi?this.input.dispose():qs(this.input)&&this.input.disconnect()),Ss(this.output)&&(this.output instanceof Mi?this.output.dispose():qs(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Di(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof Mi?t.connect(e):qs(t)&&Ii(t,e),e)),e)}function Ii(t,e,n=0,s=0){for(ys(Ss(t),"Cannot connect from undefined node"),ys(Ss(e),"Cannot connect to undefined node"),(e instanceof Mi||qs(e))&&ys(e.numberOfInputs>0,"Cannot connect to node with no inputs"),ys(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Mi||e instanceof Ri;)Ss(e.input)&&(e=e.input);for(;t instanceof Mi;)Ss(t.output)&&(t=t.output);Vs(e)?t.connect(e,n):t.connect(e,n,s)}function Pi(t,e,n=0,s=0){if(Ss(e))for(;e instanceof Mi;)e=e.input;for(;!qs(t);)Ss(t.output)&&(t=t.output);Vs(e)?t.disconnect(e,n):qs(e)?t.disconnect(e,n,s):t.disconnect()}class Ni extends Mi{constructor(){super(zs(Ni.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=zs(Ni.getDefaults(),arguments,["gain","units"]);this.gain=new Ri({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),oi(this,"gain")}static getDefaults(){return Object.assign(Mi.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Vi extends Mi{constructor(t){super(t),this.onended=ci,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Ni({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(Mi.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ci})}_startGain(t,e=1){ys(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){ys(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ci&&(this.onended(this),this.onended=ci,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),ys(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class qi extends Vi{constructor(){super(zs(qi.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=zs(qi.getDefaults(),arguments,["offset"]);Ii(this._source,this._gainNode),this.offset=new Ri({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Vi.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Li extends Mi{constructor(){super(zs(Li.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=zs(Li.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new qi({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Mi.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Fi(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Fi(t,e,n,s){(e instanceof Ri||Vs(e)||e instanceof Li&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Li&&(e.overridden=!0)),Ii(t,e,n,s)}class ji extends Ri{constructor(){super(zs(ji.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Js(1/0),this._multiplier=1;const t=zs(ji.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ri.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let t=0;t<=i;t++){const i=r*t+s.time,o=this._exponentialInterpolate(s.time,s.value,e,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Cs(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-e.time),r=Math.sqrt(Math.pow(s,2)-2*i*(e.ticks-t)),o=(-s+r)/i,a=(-s-r)/i;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Bi extends Li{constructor(){super(zs(Bi.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=zs(Bi.getDefaults(),arguments,["value"]);this.input=this._param=new ji({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Li.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Ui extends Oi{constructor(){super(zs(Ui.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Ei,this._tickOffset=new Js;const t=zs(Ui.getDefaults(),arguments,["frequency"]);this.frequency=new Bi({context:this.context,units:t.units,value:t.frequency}),oi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Oi.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Ss(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(i=n.seconds,e=n.time),"started"===s.state&&"started"!==t.state&&(i+=t.time-e),s=t})),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,(e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let c=Math.ceil(a)-a;c=Qs(c,1)?0:c;let u=this.frequency.getTimeOfTick(o+c);for(;u<e;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(t){i=t;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class zi extends Oi{constructor(){super(zs(zi.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=ci,this._lastUpdate=0,this._state=new Ei("stopped"),this._boundLoop=this._loop.bind(this);const t=zs(zi.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Ui({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,oi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Oi.getDefaults(),{callback:ci,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){bs(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}si.mixin(zi);class Wi extends Mi{constructor(){super(zs(Wi.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=zs(Wi.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new Ri({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),oi(this,"delayTime")}static getDefaults(){return Object.assign(Mi.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Gi extends Hs{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=zs(Gi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:ci,onload:ci,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return ys(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=ci,s=ci){return Es(e)?this._buffers.set(t.toString(),new ui(this.baseUrl+e,n,s)):this._buffers.set(t.toString(),new ui(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class Hi extends Ci{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return yi(super._frequencyToUnits(t))}_ticksToUnits(t){return yi(super._ticksToUnits(t))}_beatsToUnits(t){return yi(super._beatsToUnits(t))}_secondsToUnits(t){return yi(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return bi(this.toMidi())}transpose(t){return new Hi(this.context,this.toMidi()+t)}}class Xi extends Ai{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Yi extends Oi{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Js,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}ti((t=>{t.draw=new Yi({context:t})})),ni((t=>{t.draw.dispose()}));class $i extends Hs{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){ys(Ss(t.time),"Events must have a time property"),ys(Ss(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new Zi(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class Zi{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Qi extends Mi{constructor(){super(zs(Qi.getDefaults(),arguments,["volume"])),this.name="Volume";const t=zs(Qi.getDefaults(),arguments,["volume"]);this.input=this.output=new Ni({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,oi(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(Mi.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Ji extends Mi{constructor(){super(zs(Ji.getDefaults(),arguments)),this.name="Destination",this.input=new Qi({context:this.context}),this.output=new Ni({context:this.context}),this.volume=this.input.volume;const t=zs(Ji.getDefaults(),arguments);Di(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Mi.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Di(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}ti((t=>{t.destination=new Ji({context:t})})),ni((t=>{t.destination.dispose()}));class Ki extends Hs{constructor(t){super(),this.name="TimelineValue",this._timeline=new Js({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class tr{constructor(t,e){this.id=tr._eventId++,this._remainderTime=0;const n=Object.assign(tr.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:ci,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}tr._eventId=0;class er extends tr{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(er.getDefaults(),e);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},tr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return Zs(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Xi(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){Zs(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Xi(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);Ys(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class nr extends Oi{constructor(){super(zs(nr.getDefaults(),arguments)),this.name="Transport",this._loop=new Ki(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Js,this._repeatedEvents=new $i,this._syncedSignals=[],this._swingAmount=0;const t=zs(nr.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new zi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),oi(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(Oi.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new Xi(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new tr(this,{callback:t,time:new Ai(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new er(this,{callback:t,duration:new Ti(this.context,s).toTicks(),interval:new Ti(this.context,e).toTicks(),time:new Ai(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new tr(this,{callback:t,once:!0,time:new Ai(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new Xi(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return Ss(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Os(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Ti(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Ti(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Xi(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Xi(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/s}else e=0}const n=new Ni(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),ai(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}si.mixin(nr),ti((t=>{t.transport=new nr({context:t})})),ni((t=>{t.transport.dispose()}));class sr extends Mi{constructor(t){super(t),this.input=void 0,this._state=new Ei("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ci,this._syncedStop=ci,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Qi({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,oi(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(Mi.getDefaults(),{mute:!1,onstop:ci,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=Cs(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(Ws(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else bs(this.context),this._start(s,e,n);else ys(Ys(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=Cs(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Ss(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ci,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ir extends Vi{constructor(){super(zs(ir.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=zs(ir.getDefaults(),arguments,["url","onload"]);Ii(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ri({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new ui(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Vi.getDefaults(),{url:new ui,loop:!1,loopEnd:0,loopStart:0,onload:ci,onerror:ci,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){ys(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?Ws(e,this.loopStart):Ws(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;$s(r,t)&&(r=(r-e)%n+e),Qs(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Zs(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),Ss(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class rr extends sr{constructor(){super(zs(rr.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=zs(rr.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(sr.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(ys(t in cr,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=cr[this._type];this._source=new ir({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const or=220500,ar={brown:null,pink:null,white:null},cr={get brown(){if(!ar.brown){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(or);t[e]=n;let s=0;for(let t=0;t<or;t++){const e=2*Math.random()-1;n[t]=(s+.02*e)/1.02,s=n[t],n[t]*=3.5}}ar.brown=(new ui).fromArray(t)}return ar.brown},get pink(){if(!ar.pink){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(or);let s,i,r,o,a,c,u;t[e]=n,s=i=r=o=a=c=u=0;for(let t=0;t<or;t++){const e=2*Math.random()-1;s=.99886*s+.0555179*e,i=.99332*i+.0750759*e,r=.969*r+.153852*e,o=.8665*o+.3104856*e,a=.55*a+.5329522*e,c=-.7616*c-.016898*e,n[t]=s+i+r+o+a+c+u+.5362*e,n[t]*=.11,u=.115926*e}}ar.pink=(new ui).fromArray(t)}return ar.pink},get white(){if(!ar.white){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(or);t[e]=n;for(let t=0;t<or;t++)n[t]=2*Math.random()-1}ar.white=(new ui).fromArray(t)}return ar.white}};function ur(t,e){return Ps(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new hi(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0);return(yield s.render()).getChannelData(0)}))}class hr extends Vi{constructor(){super(zs(hr.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=zs(hr.getDefaults(),arguments,["frequency","type"]);Ii(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ri({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ri({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),oi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Vi.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class lr extends sr{constructor(){super(zs(lr.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=zs(lr.getDefaults(),arguments,["frequency","type"]);this.frequency=new Li({context:this.context,units:"frequency",value:t.frequency}),oi(this,"frequency"),this.detune=new Li({context:this.context,units:"cents",value:t.detune}),oi(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(sr.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new hr({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return lr._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=lr._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Ss(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),lr._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),lr._periodicWaveCache.length>100&&lr._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){ws(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(s[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*s),n);return i=-this._inverseFFT(t,e,this._phase)/n,r=-1,o=1,Math.max(Math.min(i,o),r);var i,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}lr._periodicWaveCache=[];class pr extends Mi{constructor(){super(Object.assign(zs(pr.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return Fi(this,t,e,n),this}}class dr extends pr{constructor(){super(Object.assign(zs(dr.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=zs(dr.getDefaults(),arguments,["mapping","length"]);Os(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Li.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){ys(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class fr extends pr{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new dr({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class mr extends Li{constructor(){super(Object.assign(zs(mr.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=zs(mr.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Ni({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Li.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class _r extends sr{constructor(){super(zs(_r.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new fr({context:this.context}),this._modulationNode=new Ni({context:this.context});const t=zs(_r.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new lr({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new lr({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new mr({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),oi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(lr.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class gr extends sr{constructor(){super(zs(gr.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Ni({context:this.context,gain:0});const t=zs(gr.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new lr({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Li({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new lr({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new mr({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new mr({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),oi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(lr.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class vr extends sr{constructor(){super(zs(vr.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Ni({context:this.context,gain:0}),this._thresh=new dr({context:this.context,mapping:t=>t<=0?-1:1});const t=zs(vr.getDefaults(),arguments,["frequency","width"]);this.width=new Li({context:this.context,units:"audioRange",value:t.width}),this._triangle=new lr({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),oi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(sr.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class yr extends sr{constructor(){super(zs(yr.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=zs(yr.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Li({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Li({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,oi(this,["frequency","detune"])}static getDefaults(){return Object.assign(lr.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,s)=>t.detune.value=e+n*s))}}get count(){return this._oscillators.length}set count(t){if(ws(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new lr({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):ci});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class wr extends sr{constructor(){super(zs(wr.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new mr({context:this.context,value:2});const t=zs(wr.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new vr({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new lr({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),oi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(sr.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const br={am:_r,fat:yr,fm:gr,oscillator:lr,pulse:vr,pwm:wr};class xr extends sr{constructor(){super(zs(xr.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=zs(xr.getDefaults(),arguments,["frequency","type"]);this.frequency=new Li({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Li({context:this.context,units:"cents",value:t.detune}),oi(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(lr.getDefaults(),gr.getDefaults(),_r.getDefaults(),yr.getDefaults(),vr.getDefaults(),wr.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=br[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof br[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&ks(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&ks(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Es(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){return ur(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Tr extends Li{constructor(){super(Object.assign(zs(Tr.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new Ni({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Di(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Li.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Cr extends pr{constructor(){super(Object.assign(zs(Cr.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=zs(Cr.getDefaults(),arguments,["min","max"]);this._mult=this.input=new mr({context:this.context,value:t.max-t.min}),this._add=this.output=new Tr({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(pr.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Sr extends pr{constructor(){super(Object.assign(zs(Sr.getDefaults(),arguments))),this.name="Zero",this._gain=new Ni({context:this.context}),this.output=this._gain,this.input=void 0,Ii(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Pi(this.context.getConstant(0),this._gain),this}}class kr extends Mi{constructor(){super(zs(kr.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ri.prototype._fromType,this._toType=Ri.prototype._toType,this._is=Ri.prototype._is,this._clampValue=Ri.prototype._clampValue;const t=zs(kr.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new lr(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Ni({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Li({context:this.context,units:"audioRange",value:0}),this._zeros=new Sr({context:this.context}),this._a2g=new fr({context:this.context}),this._scaler=this.output=new Cr({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),oi(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(lr.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof Ri||t instanceof Li)&&(this.convert=t.convert,this.units=t.units),Fi(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Ar(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){ws(s,t,e),n.set(this,s)}})}}function Or(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){ws(this.toSeconds(s),t,e),n.set(this,s)}})}}class Er extends sr{constructor(){super(zs(Er.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=zs(Er.getDefaults(),arguments,["url","onload"]);this._buffer=new ui({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(sr.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ci,onerror:ci,playbackRate:1,reverse:!1})}load(t){return Ps(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=ci){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?Ws(e,this._loopStart):Ws(e,0);const s=this.toSeconds(e),i=n;n=Ws(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new ir({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Cs(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&ws(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&ws(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Is([Or(0)],Er.prototype,"fadeIn",void 0),Is([Or(0)],Er.prototype,"fadeOut",void 0);class Rr extends sr{constructor(){super(zs(Rr.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const t=zs(Rr.getDefaults(),arguments,["url","onload"]);this.buffer=new ui({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new zi({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(sr.getDefaults(),{onload:ci,onerror:ci,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,n){e=Ws(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const s=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/s),n&&this.stop(t+this.toSeconds(n))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach((e=>{e.fadeOut=0,e.stop(t)})),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),n=e*this._grainSize;if(this.log("offset",n),!this.loop&&n>this.buffer.duration)return void this.stop(t);const s=n<this._overlap?0:this._overlap,i=new ir({context:this.context,url:this.buffer,fadeIn:s,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:gi(this.detune/100)}).connect(this.output);i.start(t,this._grainSize*e),i.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(i),i.onended=()=>{const t=this._activeSources.indexOf(i);-1!==t&&this._activeSources.splice(t,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){ws(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&ws(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&ws(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);ws(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((t=>t.dispose())),this}}class Mr extends pr{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new dr({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Dr extends Mi{constructor(){super(zs(Dr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Li({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=zs(Dr.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(Mi.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Es(t))return t;{let n;for(n in Ir)if(Ir[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Es(n)&&Reflect.has(Ir,n)){const s=Ir[n];As(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!Os(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){ys(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let s=this._attackCurve;for(let t=1;t<s.length;t++)if(s[t-1]<=i&&i<=s[t]){s=this._attackCurve.slice(t),s[0]=i;break}this._sig.setValueCurveAtTime(s,t,n,e)}if(s&&this.sustain<1){const i=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(ys(Os(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Fi(this,t,e,n),this}asArray(t=1024){return Ps(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new hi(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Is([Or(0)],Dr.prototype,"attack",void 0),Is([Or(0)],Dr.prototype,"decay",void 0),Is([Ar(0,1)],Dr.prototype,"sustain",void 0),Is([Or(0)],Dr.prototype,"release",void 0);const Ir=(()=>{const t=128;let e,n;const s=[];for(e=0;e<t;e++)s[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*n}i[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,s=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(s*(1-n))}function c(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:c(a),Out:a},cosine:{In:s,Out:(u=s,u.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:c(i)},sine:{In:o,Out:c(o)},step:{In:r,Out:c(r)}};var u})();class Pr extends Mi{constructor(){super(zs(Pr.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=zs(Pr.getDefaults(),arguments);this._volume=this.output=new Qi({context:this.context,volume:t.volume}),this.volume=this._volume.volume,oi(this,"volume")}static getDefaults(){return Object.assign(Mi.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule((s=>{t[e]=s,n.apply(this,t)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Nr extends Pr{constructor(){super(zs(Nr.getDefaults(),arguments));const t=zs(Nr.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Pr.getDefaults(),{detune:0,onsilence:ci,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof Ci?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Is([Or(0)],Nr.prototype,"portamento",void 0);class Vr extends Dr{constructor(){super(zs(Vr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Ni({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class qr extends Nr{constructor(){super(zs(qr.getDefaults(),arguments)),this.name="Synth";const t=zs(qr.getDefaults(),arguments);this.oscillator=new xr(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Vr(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),oi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Nr.getDefaults(),{envelope:Object.assign(Gs(Dr.getDefaults(),Object.keys(Mi.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Gs(xr.getDefaults(),[...Object.keys(sr.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Lr extends Nr{constructor(){super(zs(Lr.getDefaults(),arguments)),this.name="ModulationSynth";const t=zs(Lr.getDefaults(),arguments);this._carrier=new qr({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new qr({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Li({context:this.context,units:"frequency"}),this.detune=new Li({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new mr({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new Ni({context:this.context,gain:0}),oi(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Nr.getDefaults(),{harmonicity:3,oscillator:Object.assign(Gs(xr.getDefaults(),[...Object.keys(sr.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(Gs(Dr.getDefaults(),Object.keys(Mi.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Gs(xr.getDefaults(),[...Object.keys(sr.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(Gs(Dr.getDefaults(),Object.keys(Mi.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Fr extends Lr{constructor(){super(zs(Fr.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new fr({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class jr extends Mi{constructor(){super(zs(jr.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const t=zs(jr.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Ri({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Ri({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Ri({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Ri({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(Mi.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){ys(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let n=0;n<t;n++){const s=19980*Math.pow(n/t,2)+20;e[n]=s}const n=new Float32Array(t),s=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,n,s),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Br extends qr{constructor(){super(zs(Br.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=zs(Br.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,oi(this,["oscillator","envelope"])}static getDefaults(){return Us(Nr.getDefaults(),qr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof Ci?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Is([Ar(0)],Br.prototype,"octaves",void 0),Is([Or(0)],Br.prototype,"pitchDecay",void 0);const Ur=new Set;function zr(t){Ur.add(t)}function Wr(t,e){const n=`registerProcessor("${t}", ${e})`;Ur.add(n)}zr('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');zr("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");zr("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");Wr("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Gr extends Pr{constructor(){super(zs(Gr.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const t=zs(Gr.getDefaults(),arguments,["voice","options"]);ys(!ks(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Pr.getDefaults(),{maxPolyphony:32,options:{},voice:qr})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex((e=>e.voice===t));this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}Ts("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,n){t.forEach((t=>{const s=new Hi(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,n),this._activeVoices.push({midi:s,voice:i,released:!1}),this.log("triggerAttack",t,e))}))}_triggerRelease(t,e){t.forEach((t=>{const n=new Hi(this.context,t).toMidi(),s=this._activeVoices.find((({midi:t,released:e})=>t===n&&!e));s&&(s.voice.triggerRelease(e),s.released=!0,this.log("triggerRelease",t,e))}))}_scheduleEvent(t,e,n,s){ys(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,s):this._triggerRelease(e,n):this.context.setTimeout((()=>{this._scheduleEvent(t,e,n,s)}),n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("attack",t,s,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("release",t,n),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n);if(this.triggerAttack(t,i,s),Os(e)){ys(Os(t),"If the duration is an array, the notes must also be an array"),t=t;for(let n=0;n<t.length;n++){const s=e[Math.min(n,e.length-1)],r=this.toSeconds(s);ys(r>0,"The duration must be greater than 0"),this.triggerRelease(t[n],i+r)}}else{const n=this.toSeconds(e);ys(n>0,"The duration must be greater than 0"),this.triggerRelease(t,i+n)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){const e=Gs(t,["onsilence","context"]);return this.options=Us(this.options,e),this._voices.forEach((t=>t.set(e))),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach((({voice:t})=>{t.triggerRelease(e)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((t=>t.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Hr extends Pr{constructor(){super(zs(Hr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=zs(Hr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const s=parseInt(n,10);if(ys(Rs(n)||ks(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),Rs(n)){const s=new Ci(this.context,n).toMidi();e[s]=t.urls[n]}else ks(s)&&isFinite(s)&&(e[s]=t.urls[s])})),this._buffers=new Gi({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Pr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ci,onerror:ci,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=wi(new Ci(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,c=this._buffers.get(a),u=gi(o+r),h=new ir({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);h.start(e,0,c.duration/u,n),Os(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(h),h.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(h);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new Ci(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),Os(e)?(ys(Os(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(ys(Rs(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Rs(t)){const s=new Ci(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}Is([Or(0)],Hr.prototype,"attack",void 0),Is([Or(0)],Hr.prototype,"release",void 0);class Xr extends Mi{constructor(){super(Object.assign(zs(Xr.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Mr({context:this.context}),this.a=new Ni({context:this.context,gain:0}),this.b=new Ni({context:this.context,gain:0}),this.output=new Ni({context:this.context}),this._internalChannels=[this.a,this.b];const t=zs(Xr.getDefaults(),arguments,["fade"]);this.fade=new Li({context:this.context,units:"normalRange",value:t.fade}),oi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Ii(this._split,this.a.gain,0),Ii(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Mi.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Yr extends Mi{constructor(t){super(t),this.name="Effect",this._dryWet=new Xr({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Ni({context:this.context}),this.effectReturn=new Ni({context:this.context}),this.input=new Ni({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],oi(this,"wet")}static getDefaults(){return Object.assign(Mi.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class $r extends Mi{constructor(){super(Object.assign(zs($r.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=zs($r.getDefaults(),arguments,["pan"]);this.pan=new Ri({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",oi(this,"pan")}static getDefaults(){return Object.assign(Mi.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}Wr("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Zr extends Mi{constructor(){super(zs(Zr.getDefaults(),arguments,["channels"])),this.name="Split";const t=zs(Zr.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Mi.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Qr extends Mi{constructor(){super(zs(Qr.getDefaults(),arguments,["channels"])),this.name="Merge";const t=zs(Qr.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(Mi.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Jr extends Mi{constructor(t){super(t),this.name="StereoEffect",this.input=new Ni({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new Xr({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new Zr({context:this.context,channels:2}),this._merge=new Qr({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),oi(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),Di(...t),Ii(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),Di(...t),Ii(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Mi.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Kr extends Jr{constructor(t){super(t),this.feedback=new Li({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new Ni({context:this.context}),this._feedbackR=new Ni({context:this.context}),this._feedbackSplit=new Zr({context:this.context,channels:2}),this._feedbackMerge=new Qr({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),oi(this,["feedback"])}static getDefaults(){return Object.assign(Jr.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class to extends Kr{constructor(){super(zs(to.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const t=zs(to.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new kr({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new kr({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Wi({context:this.context}),this._delayNodeR=new Wi({context:this.context}),this.frequency=this._lfoL.frequency,oi(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(Kr.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class eo extends Yr{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new Ni({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,oi(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Yr.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class no extends eo{constructor(){super(zs(no.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const t=zs(no.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Wi({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),oi(this,"delayTime")}static getDefaults(){return Object.assign(eo.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class so extends eo{constructor(){super(zs(so.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=zs(so.getDefaults(),arguments,["pitch"]);this._frequency=new Li({context:this.context}),this._delayA=new Wi({maxDelay:1,context:this.context}),this._lfoA=new kr({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Wi({maxDelay:1,context:this.context}),this._lfoB=new kr({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new Xr({context:this.context}),this._crossFadeLFO=new kr({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Wi({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,oi(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(eo.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=gi(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=gi(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class io extends Yr{constructor(){super(zs(io.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=zs(io.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Yr.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){ws(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){ws(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return Ps(this,void 0,void 0,(function*(){const t=this.ready,e=new hi(2,this._decay+this._preDelay,this.context.sampleRate),n=new rr({context:e}),s=new rr({context:e}),i=new Qr({context:e});n.connect(i,0,0),s.connect(i,0,1);const r=new Ni({context:e}).toDestination();i.connect(r),n.start(0),s.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=e.render();return this.ready=o.then(ci),yield t,this._convolver.buffer=(yield o).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class ro extends Mi{constructor(){super(zs(ro.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const t=zs(ro.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new Ni({context:this.context}),this._split=new Zr({context:this.context,channels:t.channels}),this.input.connect(this._split),ws(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type}static getDefaults(){return Object.assign(Mi.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((t,e)=>{const n=this._buffers[e];"fft"===this._type?t.getFloatFrequencyData(n):"waveform"===this._type&&t.getFloatTimeDomainData(n)})),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach(((e,n)=>{e.fftSize=2*t,this._buffers[n]=new Float32Array(t)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(t){ys("waveform"===t||"fft"===t,`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach((e=>e.smoothingTimeConstant=t))}dispose(){return super.dispose(),this._analysers.forEach((t=>t.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class oo extends Mi{constructor(){super(zs(oo.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new ro({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class ao extends oo{constructor(){super(zs(ao.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const t=zs(ao.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new ro({context:this.context,size:256,type:"waveform",channels:t.channels}),this.smoothing=t.smoothing,this.normalRange=t.normalRange}static getDefaults(){return Object.assign(oo.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return Ts("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),e=(1===this.channels?[t]:t).map((t=>{const e=t.reduce(((t,e)=>t+e*e),0),n=Math.sqrt(e/t.length);return this._rms=Math.max(n,this._rms*this.smoothing),this.normalRange?this._rms:_i(this._rms)}));return 1===this.channels?e[0]:e}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class co extends Mi{constructor(){super(zs(co.getDefaults(),arguments,["solo"])),this.name="Solo";const t=zs(co.getDefaults(),arguments,["solo"]);this.input=this.output=new Ni({context:this.context}),co._allSolos.has(this.context)||co._allSolos.set(this.context,new Set),co._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(Mi.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),co._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){co._soloed.has(this.context)||co._soloed.set(this.context,new Set),co._soloed.get(this.context).add(this)}_removeSolo(){co._soloed.has(this.context)&&co._soloed.get(this.context).delete(this)}_isSoloed(){return co._soloed.has(this.context)&&co._soloed.get(this.context).has(this)}_noSolos(){return!co._soloed.has(this.context)||co._soloed.has(this.context)&&0===co._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),co._allSolos.get(this.context).delete(this),this._removeSolo(),this}}co._allSolos=new Map,co._soloed=new Map;class uo extends Mi{constructor(){super(zs(uo.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=zs(uo.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new $r({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Qi({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,oi(this,["pan","volume"])}static getDefaults(){return Object.assign(Mi.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class ho extends Mi{constructor(){super(zs(ho.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=zs(ho.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new co({solo:t.solo,context:this.context}),this._panVol=this.output=new uo({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),oi(this,["pan","volume"])}static getDefaults(){return Object.assign(Mi.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return ho.buses.has(t)||ho.buses.set(t,new Ni({context:this.context})),ho.buses.get(t)}send(t,e=0){const n=this._getBus(t),s=new Ni({context:this.context,units:"decibels",gain:e});return this.connect(s),s.connect(n),s}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}ho.buses=new Map;class lo extends Mi{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ri({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ri({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ri({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ri({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ri({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ri({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ri({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ri({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ri({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Mi.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ti((t=>{t.listener=new lo({context:t})})),ni((t=>{t.listener.dispose()}));class po extends Mi{constructor(){super(zs(po.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const t=zs(po.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new Ri({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new Ri({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new Ri({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new Ri({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new Ri({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),oi(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Mi.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class fo extends Mi{constructor(){super(Object.assign(zs(fo.getDefaults(),arguments,["threshold"]))),this.name="Limiter";const t=zs(fo.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new po({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,oi(this,"threshold")}static getDefaults(){return Object.assign(Mi.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}function mo(){return di().now()}const _o=di().transport;di().destination,di().destination;di().listener;di().draw;di();i(666);const go=class{constructor(t,e,n=2){this.grains=[],this.isStopped=!1,this.numVoices=n,this.buffer=t,this.toneContext=e,this.dest=this.toneContext.destination,this.dest.name="Grainsynth Destination",this.grainOutput=new Ni(1),this.grainOutput.name="Grain Output",this.filter=new jr(1e4,"lowpass"),this.compressor=new po({threshold:-6,knee:0,ratio:20,attack:.001,release:.1}),this.pitchShifter=new so({pitch:-12});for(let t=0;t<this.numVoices;t++)this.grains[t]=new Rr(this.buffer),this.grains[t].unsync();this.setupMaster()}reloadBuffers(){this.grains.forEach((t=>{t.buffer._buffer.copyToChannel(this.buffer.getChannelData(0),0,0)}))}getNodes(){Object.entries(this).forEach((t=>{const e=t[1];"object"==typeof e&&e.connect&&console.log(e)}))}debug(){this.grains.forEach((t=>{t.debug=!0,t.playbackRate=1,t.grainSize=.5})),this.setClockFrequency(1)}setupMaster(){this.grains.forEach((async t=>{t.loop=!0,t.connect(this.grainOutput)})),this.grainOutput.connect(this.filter),this.output=new Ni(1),this.output.name="Output",this.output.gain.setValueAtTime(.7/this.numVoices,mo()),this.pitchShifter.windowSize=1,this.filter.connect(this.compressor),window.isMp3?(this.compressor.connect(this.pitchShifter),this.pitchShifter.connect(this.output)):(this.pitchShifter.dispose(),this.compressor.dispose(),this.filter.connect(this.output)),this.output.connect(this.dest)}isGrainLoaded(t){return new Promise(((e,n)=>{t.onerror&&n("couldn't load grains"),t.loaded&&e(t.loaded)}))}async play(t=1){this.output.gain.setValueAtTime(1/this.numVoices,mo());const e=this.grains.map((t=>this.isGrainLoaded(t)));await Promise.all(e),this.grains.forEach((async(e,n)=>{e.start(`+${n}`,n+t)})),this.isStopped=!1}stop(){this.grains.forEach((t=>{t.stop()})),this.isStopped=!0}kill(){this.grains.forEach((t=>t.dispose()))}setClockFrequency(t){this.grains.forEach((e=>e._clock.frequency.targetRampTo(t,"+0.1")))}randomStarts(){this.grains.forEach((t=>{t.stop(),t.start(mo(),Math.random()*t.buffer.duration)}))}randRange(t,e){return Math.random()*(e-t)+t}getCurrentValues(){const t=[];return["detune","overlap","grainSize","loopStart","loopEnd","playbackRate"].forEach((e=>{t.push(t[e]=this.getGrainValues(e))})),t}setCurrentValues(t){this.grains.forEach(((e,n)=>{e.detune=t.detune[n],e.overlap=t.overlap[n],e.grainSize=t.grainSize[n],e.loopEnd=t.loopEnd[n],e.loopStart=t.loopStart[n],e.playbackRate=t.playbackRate[n],e.reverse=Math.random()<.5}))}randArrayFromRange(t,e,n){return Array.from({length:t},(()=>this.randRange(e,n)))}randomInterpolate(){const t=this.grains.length,e={detune:this.randArrayFromRange(t,-1e3,100),overlap:this.randArrayFromRange(t,.01,.05),grainSize:this.randArrayFromRange(t,.001,.5),playbackRate:this.randArrayFromRange(t,.01,.1),loopEnd:this.randArrayFromRange(t,0,this.buffer.duration)};e.loopStart=this.randArrayFromRange(t,0,...e.loopEnd),this.setClockFrequency(.5*Math.random()),this.setCurrentValues(e)}outputMeter(){this.outputMeter=new ao,this.output.connect(this.outputMeter)}getMeterValue(){return this.outputMeter.getValue()}setPitchShift(t){this.pitchShifter.pitch=Number(t)}getPitchShift(){return this.pitchShifter.pitch}setDetune(t){const e=t/2;this.grains.forEach((n=>n.detune=Math.random()*t-e))}getGrainValues(t){const e=[];return this.grains.forEach((n=>{t in n&&e.push(n[t])})),e}setRate(t){this.grains.forEach((e=>e.playbackRate=t))}setOverlap(t){this.grains.forEach((e=>e.overlap=t))}setGrainSize(t){this.grains.forEach((e=>e.grainSize=t))}setLoopStart(t){this.grains.forEach((e=>e.loopStart=t))}setLoopEnd(t){this.grains.forEach((e=>e.loopEnd=t))}setVolume(t){this.output.gain.setValueAtTime(t,this.toneContext.currentTime)}rampVolume(t,e){this.output.gain.rampTo(t,e)}};var vo=function(t,e){return(vo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function yo(t,e){function n(){this.constructor=t}vo(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var wo=function(){return(wo=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function bo(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}function xo(t,e){var n,s,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(i=2&r[0]?s.return:r[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function To(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Co(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var s,i,r=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(t){i={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return o}function So(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Co(arguments[e]));return t}function ko(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}var Ao=function(t){for(var e=[],n=0,s=0;s<t.length;s++){var i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++s)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e};function Oo(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=Oo(t[n],e[n]));return t}var Eo=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,s){n?e.reject(n):e.resolve(s),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,s))}},t}();function Ro(){try{return"[object process]"===Object.prototype.toString.call(i.g.process)}catch(t){return!1}}var Mo=function(t){function e(n,s,i){var r=t.call(this,s)||this;return r.code=n,r.customData=i,r.name="FirebaseError",Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,Do.prototype.create),r}return yo(e,t),e}(Error),Do=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=e[0]||{},i=this.service+"/"+t,r=this.errors[t],o=r?Io(r,s):"Error",a=this.serviceName+": "+o+" ("+i+").",c=new Mo(i,a,s);return c},t}();function Io(t,e){return t.replace(Po,(function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"}))}var Po=/\{\$([^}]+)}/g;function No(t,e){return Object.prototype.hasOwnProperty.call(t,e)}!function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var s=0;s<16;s++)n[s]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(s=0;s<16;s++)n[s]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(s=16;s<80;s++){var i=n[s-3]^n[s-8]^n[s-14]^n[s-16];n[s]=4294967295&(i<<1|i>>>31)}var r,o,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(s=0;s<80;s++){s<40?s<20?(r=h^c&(u^h),o=1518500249):(r=c^u^h,o=1859775393):s<60?(r=c&u|h&(c|u),o=2400959708):(r=c^u^h,o=3395469782);i=(a<<5|a>>>27)+r+l+o+n[s]&4294967295;l=h,h=u,u=4294967295&(c<<30|c>>>2),c=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,s=0,i=this.buf_,r=this.inbuf_;s<e;){if(0===r)for(;s<=n;)this.compress_(t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(i[r]=t.charCodeAt(s),++s,++r===this.blockSize){this.compress_(i),r=0;break}}else for(;s<e;)if(i[r]=t[s],++s,++r===this.blockSize){this.compress_(i),r=0;break}}this.inbuf_=r,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var s=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[s]=this.chain_[n]>>i&255,++s;return t}}();function Vo(t,e){var n=new qo(t,e);return n.subscribe.bind(n)}var qo=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var s,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(s=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,s=e;n<s.length;n++){var i=s[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(s.next=Lo),void 0===s.error&&(s.error=Lo),void 0===s.complete&&(s.complete=Lo);var r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?s.error(i.finalError):s.complete()}catch(t){}})),this.observers.push(s),r},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function Lo(){}var Fo=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),jo="[DEFAULT]",Bo=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t=jo);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new Eo;this.instancesDeferred.set(e,n);try{var s=this.getOrInitializeService(e);s&&n.resolve(s)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=wo({identifier:jo,optional:!1},t),n=e.identifier,s=e.optional,i=this.normalizeInstanceIdentifier(n);try{var r=this.getOrInitializeService(i);if(!r){if(s)return null;throw Error("Service "+this.name+" is not available")}return r}catch(t){if(s)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService(jo)}catch(t){}try{for(var s=To(this.instancesDeferred.entries()),i=s.next();!i.done;i=s.next()){var r=Co(i.value,2),o=r[0],a=r[1],c=this.normalizeInstanceIdentifier(o);try{var u=this.getOrInitializeService(c);a.resolve(u)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t=jo),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return bo(this,void 0,void 0,(function(){var t;return xo(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(So(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})),t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()}))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return t===jo?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:jo:t},t}();var Uo,zo=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new Bo(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();function Wo(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}var Go,Ho=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Go||(Go={}));var Xo,Yo={debug:Go.DEBUG,verbose:Go.VERBOSE,info:Go.INFO,warn:Go.WARN,error:Go.ERROR,silent:Go.SILENT},$o=Go.INFO,Zo=((Uo={})[Go.DEBUG]="log",Uo[Go.VERBOSE]="log",Uo[Go.INFO]="info",Uo[Go.WARN]="warn",Uo[Go.ERROR]="error",Uo),Qo=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=Zo[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,Wo(["["+i+"]  "+t.name+":"],n))}},Jo=function(){function t(t){this.name=t,this._logLevel=$o,this._logHandler=Qo,this._userLogHandler=null,Ho.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Go))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?Yo[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Wo([this,Go.DEBUG],t)),this._logHandler.apply(this,Wo([this,Go.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Wo([this,Go.VERBOSE],t)),this._logHandler.apply(this,Wo([this,Go.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Wo([this,Go.INFO],t)),this._logHandler.apply(this,Wo([this,Go.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Wo([this,Go.WARN],t)),this._logHandler.apply(this,Wo([this,Go.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Wo([this,Go.ERROR],t)),this._logHandler.apply(this,Wo([this,Go.ERROR],t))},t}();function Ko(t){Ho.forEach((function(e){e.setLogLevel(t)}))}var ta,ea=((Xo={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Xo["bad-app-name"]="Illegal App name: '{$appName}",Xo["duplicate-app"]="Firebase App named '{$appName}' already exists",Xo["app-deleted"]="Firebase App named '{$appName}' already deleted",Xo["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Xo["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Xo),na=new Do("app","Firebase",ea),sa="@firebase/app",ia="[DEFAULT]",ra=((ta={})[sa]="fire-core",ta["@firebase/analytics"]="fire-analytics",ta["@firebase/auth"]="fire-auth",ta["@firebase/database"]="fire-rtdb",ta["@firebase/functions"]="fire-fn",ta["@firebase/installations"]="fire-iid",ta["@firebase/messaging"]="fire-fcm",ta["@firebase/performance"]="fire-perf",ta["@firebase/remote-config"]="fire-rc",ta["@firebase/storage"]="fire-gcs",ta["@firebase/firestore"]="fire-fst",ta["fire-js"]="fire-js",ta["firebase-wrapper"]="fire-js-all",ta),oa=new Jo("@firebase/app"),aa=function(){function t(t,e,n){var s,i,r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Oo(void 0,t),this.container=new zo(e.name),this._addComponent(new Fo("app",(function(){return r}),"PUBLIC"));try{for(var o=To(this.firebase_.INTERNAL.components.values()),a=o.next();!a.done;a=o.next()){var c=a.value;this._addComponent(c)}}catch(t){s={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(s)throw s.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e=ia),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=ia),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){oa.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw na.create("app-deleted",{appName:this.name_})},t}();aa.prototype.name&&aa.prototype.options||aa.prototype.delete||console.log("dc");function ca(t){var e={},n=new Map,s={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var r=i;void 0===r.name&&(r.name=ia);var o=r.name;if("string"!=typeof o||!o)throw na.create("bad-app-name",{appName:String(o)});if(No(e,o))throw na.create("duplicate-app",{appName:o});var a=new t(n,r,s);return e[o]=a,a},app:i,registerVersion:function(t,e,n){var s,i=null!==(s=ra[t])&&void 0!==s?s:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var c=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&c.push("and"),a&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void oa.warn(c.join(" "))}r(new Fo(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:Ko,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw na.create("invalid-log-argument",{appName:name});!function(t,e){for(var n=function(n){var s=null;e&&e.level&&(s=Yo[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var o=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=s?s:e.logLevel)&&t({level:Go[n].toLowerCase(),message:o,args:i,type:e.name})}},s=0,i=Ho;s<i.length;s++)n(i[s])}(t,e)},apps:null,SDK_VERSION:"8.0.1",INTERNAL:{registerComponent:r,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(!No(e,t=t||ia))throw na.create("no-app",{appName:t});return e[t]}function r(r){var o,a,c=r.name;if(n.has(c))return oa.debug("There were multiple attempts to register component "+c+"."),"PUBLIC"===r.type?s[c]:null;if(n.set(c,r),"PUBLIC"===r.type){var u=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[c])throw na.create("invalid-app-argument",{appName:c});return t[c]()};void 0!==r.serviceProps&&Oo(u,r.serviceProps),s[c]=u,t.prototype[c]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,c);return n.apply(this,r.multipleInstances?t:[])}}try{for(var h=To(Object.keys(e)),l=h.next();!l.done;l=h.next()){var p=l.value;e[p]._addComponent(r)}}catch(t){o={error:t}}finally{try{l&&!l.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}return"PUBLIC"===r.type?s[c]:null}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,s}var ua=function t(){var e=ca(aa);return e.INTERNAL=wo(wo({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Oo(e,t)},createSubscribe:Vo,ErrorFactory:Do,deepExtend:Oo}),e}(),ha=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();if("object"==typeof self&&self.self===self&&void 0!==self.firebase){oa.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var la=self.firebase.SDK_VERSION;la&&la.indexOf("LITE")>=0&&oa.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var pa=ua.initializeApp;ua.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ro()&&oa.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),pa.apply(void 0,t)};var da=ua;!function(t,e){t.INTERNAL.registerComponent(new Fo("platform-logger",(function(t){return new ha(t)}),"PRIVATE")),t.registerVersion(sa,"0.6.13",e),t.registerVersion("fire-js","")}(da);const fa=da;fa.registerVersion("firebase","8.0.2","app");var ma="firebasestorage.googleapis.com",_a=function(t){function e(n,s){var i=t.call(this,Va(n),"Firebase Storage: "+s+" ("+Va(n)+")")||this;return i.customData={serverResponse:null},Object.setPrototypeOf(i,e.prototype),i}return yo(e,t),e.prototype.codeEquals=function(t){return Va(t)===this.code},Object.defineProperty(e.prototype,"message",{get:function(){return this.customData.serverResponse?this.message+"\n"+this.customData.serverResponse:this.message},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(t){this.customData.serverResponse=t},enumerable:!1,configurable:!0}),e}(Mo),ga="unknown",va="object-not-found",ya="quota-exceeded",wa="unauthenticated",ba="unauthorized",xa="retry-limit-exceeded",Ta="canceled",Ca="invalid-url",Sa="invalid-default-bucket",ka="no-default-bucket",Aa="cannot-slice-blob",Oa="server-file-wrong-size",Ea="no-download-url",Ra="invalid-argument",Ma="app-deleted",Da="invalid-root-operation",Ia="invalid-format",Pa="internal-error",Na="unsupported-environment";function Va(t){return"storage/"+t}function qa(){return new _a(ga,"An unknown error occurred, please check the error payload for server response.")}function La(){return new _a(Ta,"User canceled the upload/download.")}function Fa(){return new _a(Aa,"Cannot slice blob for upload. Please retry the upload.")}function ja(t){return new _a(Ra,t)}function Ba(){return new _a(Ma,"The Firebase app was deleted.")}function Ua(t){return new _a(Da,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function za(t,e){return new _a(Ia,"String does not match format '"+t+"': "+e)}function Wa(t){throw new _a(Pa,"Internal error: "+t)}var Ga={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Ha=function(t,e){this.data=t,this.contentType=e||null};function Xa(t,e){switch(t){case Ga.RAW:return new Ha(Ya(e));case Ga.BASE64:case Ga.BASE64URL:return new Ha($a(t,e));case Ga.DATA_URL:return new Ha((n=new Za(e)).base64?$a(Ga.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw za(Ga.DATA_URL,"Malformed data URL.")}return Ya(e)}(n.rest),function(t){return new Za(t).contentType}(e))}var n;throw qa()}function Ya(t){for(var e=[],n=0;n<t.length;n++){var s=t.charCodeAt(n);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|63&s);else if(55296==(64512&s))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))s=65536|(1023&s)<<10|1023&t.charCodeAt(++n),e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s);else e.push(239,191,189);else 56320==(64512&s)?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|63&s)}return new Uint8Array(e)}function $a(t,e){switch(t){case Ga.BASE64:var n=-1!==e.indexOf("-"),s=-1!==e.indexOf("_");if(n||s)throw za(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Ga.BASE64URL:var i=-1!==e.indexOf("+"),r=-1!==e.indexOf("/");if(i||r)throw za(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var o;try{o=atob(e)}catch(e){throw za(t,"Invalid character found")}for(var a=new Uint8Array(o.length),c=0;c<o.length;c++)a[c]=o.charCodeAt(c);return a}var Za=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw za(Ga.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=(s=n,i=";base64",s.length>=i.length&&s.substring(s.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1);var s,i};var Qa,Ja={STATE_CHANGED:"state_changed"},Ka="running",tc="pausing",ec="paused",nc="success",sc="canceling",ic="canceled",rc="error",oc={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function ac(t){switch(t){case Ka:case tc:case sc:return oc.RUNNING;case ec:return oc.PAUSED;case nc:return oc.SUCCESS;case ic:return oc.CANCELED;case rc:default:return oc.ERROR}}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(Qa||(Qa={}));var cc=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Qa.NO_ERROR,this.sendPromise_=new Promise((function(e){t.xhr_.addEventListener("abort",(function(){t.errorCode_=Qa.ABORT,e(t)})),t.xhr_.addEventListener("error",(function(){t.errorCode_=Qa.NETWORK_ERROR,e(t)})),t.xhr_.addEventListener("load",(function(){e(t)}))}))}return t.prototype.send=function(t,e,n,s){if(this.sent_)throw Wa("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==s)for(var i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw Wa("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw Wa("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw Wa("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)},t}(),uc=function(){function t(){}return t.prototype.createXhrIo=function(){return new cc},t}();function hc(t){return"string"==typeof t||t instanceof String}function lc(t){return pc()&&t instanceof Blob}function pc(){return"undefined"!=typeof Blob}function dc(t,e,n,s){if(s<e)throw new _a(Ra,"Invalid value for '"+t+"'. Expected "+e+" or greater.");if(s>n)throw new _a(Ra,"Invalid value for '"+t+"'. Expected "+n+" or less.")}function fc(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function mc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fc();if(void 0!==n){for(var s=new n,i=0;i<t.length;i++)s.append(t[i]);return s.getBlob()}if(pc())return new Blob(t);throw new _a(Na,"This browser doesn't seem to support creating Blobs")}var _c=function(){function t(t,e){var n=0,s="";lc(t)?(this.data_=t,n=t.size,s=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=s}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(lc(this.data_)){var s=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,e,n);return null===s?null:new t(s)}return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(pc()){var s=e.map((function(e){return e instanceof t?e.data_:e}));return new t(mc.apply(null,s))}var i=e.map((function(t){return hc(t)?Xa(Ga.RAW,t).data:t.data_})),r=0;i.forEach((function(t){r+=t.byteLength}));var o=new Uint8Array(r),a=0;return i.forEach((function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]})),new t(o,!0)},t.prototype.uploadData=function(){return this.data_},t}(),gc=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw new _a(Sa,"Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e){var n=null,s="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+s+"(/(.*))?$","i");function r(t){t.path_=decodeURIComponent(t.path)}for(var o=ma.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/"+s+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp("^https?://(?:storage.googleapis.com|storage.cloud.google.com)/"+s+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:r}],c=0;c<a.length;c++){var u=a[c],h=u.regex.exec(e);if(h){var l=h[u.indices.bucket],p=h[u.indices.path];p||(p=""),n=new t(l,p),u.postModify(n);break}}if(null==n)throw function(t){return new _a(Ca,"Invalid URL '"+t+"'.")}(e);return n},t}();function vc(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e}function yc(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function wc(t){return"https://"+ma+"/v0"+t}function bc(t){var e=encodeURIComponent,n="?";for(var s in t){if(t.hasOwnProperty(s))n=n+(e(s)+"="+e(t[s]))+"&"}return n=n.slice(0,-1)}function xc(t,e){return e}var Tc=function(t,e,n,s){this.server=t,this.local=e||t,this.writable=!!n,this.xform=s||xc},Cc=null;function Sc(){if(Cc)return Cc;var t=[];t.push(new Tc("bucket")),t.push(new Tc("generation")),t.push(new Tc("metageneration")),t.push(new Tc("name","fullPath",!0));var e=new Tc("name");e.xform=function(t,e){return function(t){return!hc(t)||t.length<2?t:yc(t)}(e)},t.push(e);var n=new Tc("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new Tc("timeCreated")),t.push(new Tc("updated")),t.push(new Tc("md5Hash",null,!0)),t.push(new Tc("cacheControl",null,!0)),t.push(new Tc("contentDisposition",null,!0)),t.push(new Tc("contentEncoding",null,!0)),t.push(new Tc("contentLanguage",null,!0)),t.push(new Tc("contentType",null,!0)),t.push(new Tc("metadata","customMetadata",!0)),Cc=t}function kc(t,e,n){for(var s={type:"file"},i=n.length,r=0;r<i;r++){var o=n[r];s[o.local]=o.xform(s,e[o.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,s=t.fullPath,i=new gc(n,s);return e.makeStorageReference(i)}})}(s,t),s}function Ac(t,e,n){var s=vc(e);return null===s?null:kc(t,s,n)}function Oc(t,e){for(var n={},s=e.length,i=0;i<s;i++){var r=e[i];r.writable&&(n[r.server]=t[r.local])}return JSON.stringify(n)}function Ec(t,e,n){var s=vc(n);return null===s?null:function(t,e,n){var s={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,r=n.prefixes;i<r.length;i++){var o=r[i].replace(/\/$/,""),a=t.makeStorageReference(new gc(e,o));s.prefixes.push(a)}if(n.items)for(var c=0,u=n.items;c<u.length;c++){var h=u[c];a=t.makeStorageReference(new gc(e,h.name)),s.items.push(a)}return s}(t,e,s)}var Rc=function(t,e,n,s){this.url=t,this.method=e,this.handler=n,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function Mc(t){if(!t)throw qa()}function Dc(t,e){return function(n,s){var i=Ac(t,s,e);return Mc(null!==i),i}}function Ic(t,e){return function(n,s){var i=Ac(t,s,e);return Mc(null!==i),function(t,e){var n=vc(e);if(null===n)return null;if(!hc(n.downloadTokens))return null;var s=n.downloadTokens;if(0===s.length)return null;var i=encodeURIComponent;return s.split(",").map((function(e){var n=t.bucket,s=t.fullPath;return wc("/b/"+i(n)+"/o/"+i(s))+bc({alt:"media",token:e})}))[0]}(i,s)}}function Pc(t){return function(e,n){var s,i,r;return 401===e.getStatus()?s=new _a(wa,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=t.bucket,s=new _a(ya,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,s=new _a(ba,"User does not have permission to access '"+i+"'.")):s=n,s.serverResponse=n.serverResponse,s}}function Nc(t){var e=Pc(t);return function(n,s){var i,r=e(n,s);return 404===n.getStatus()&&(i=t.path,r=new _a(va,"Object '"+i+"' does not exist.")),r.serverResponse=s.serverResponse,r}}function Vc(t,e,n){var s=wc(e.fullServerUrl()),i=t.maxOperationRetryTime,r=new Rc(s,"GET",Dc(t,n),i);return r.errorHandler=Nc(e),r}function qc(t,e,n,s,i){var r={};e.isRoot?r.prefix="":r.prefix=e.path+"/",n&&n.length>0&&(r.delimiter=n),s&&(r.pageToken=s),i&&(r.maxResults=i);var o=wc(e.bucketOnlyServerUrl()),a=t.maxOperationRetryTime,c=new Rc(o,"GET",function(t,e){return function(n,s){var i=Ec(t,e,s);return Mc(null!==i),i}}(t,e.bucket),a);return c.urlParams=r,c.errorHandler=Pc(e),c}function Lc(t,e,n){var s=Object.assign({},n);return s.fullPath=t.path,s.size=e.size(),s.contentType||(s.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),s}var Fc=function(t,e,n,s){this.current=t,this.total=e,this.finalized=!!n,this.metadata=s||null};function jc(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){Mc(!1)}return Mc(!!n&&-1!==(e||["active"]).indexOf(n)),n}var Bc=262144;function Uc(t,e,n,s,i,r,o,a){var c=new Fc(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new _a(Oa,"Server recorded incorrect upload file size, please retry the upload.");var u=c.total-c.current,h=u;i>0&&(h=Math.min(h,i));var l=c.current,p=l+h,d={"X-Goog-Upload-Command":h===u?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},f=s.slice(l,p);if(null===f)throw Fa();var m=e.maxUploadRetryTime,_=new Rc(n,"POST",(function(t,n){var i,o=jc(t,["active","final"]),a=c.current+h,u=s.size();return i="final"===o?Dc(e,r)(t,n):null,new Fc(a,u,"final"===o,i)}),m);return _.headers=d,_.body=f.uploadData(),_.progressCallback=a||null,_.errorHandler=Pc(t),_}var zc=function(t,e,n){if("function"==typeof t||null!=e||null!=n)this.next=t,this.error=e,this.complete=n;else{var s=t;this.next=s.next,this.error=s.error,this.complete=s.complete}},Wc=function(t,e,n,s,i,r){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=s,this.task=i,this.ref=r};function Gc(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then((function(){return t.apply(void 0,e)}))}}var Hc=function(){function t(t,e,n){var s=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=n,this._mappings=Sc(),this._resumable=this._shouldDoResumable(this._blob),this._state=Ka,this._errorHandler=function(t){s._request=void 0,s._chunkMultiplier=1,t.codeEquals(Ta)?(s._needToFetchStatus=!0,s.completeTransitions_()):(s._error=t,s._transition(rc))},this._metadataErrorHandler=function(t){s._request=void 0,t.codeEquals(Ta)?s.completeTransitions_():(s._error=t,s._transition(rc))},this._promise=new Promise((function(t,e){s._resolve=t,s._reject=e,s._start()})),this._promise.then(null,(function(){}))}return t.prototype._makeProgressCallback=function(){var t=this,e=this._transferred;return function(n){return t._updateProgress(e+n)}},t.prototype._shouldDoResumable=function(t){return t.size()>262144},t.prototype._start=function(){this._state===Ka&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},t.prototype._resolveToken=function(t){var e=this;this._ref.storage.getAuthToken().then((function(n){switch(e._state){case Ka:t(n);break;case sc:e._transition(ic);break;case tc:e._transition(ec)}}))},t.prototype._createResumable=function(){var t=this;this._resolveToken((function(e){var n=function(t,e,n,s,i){var r=e.bucketOnlyServerUrl(),o=Lc(e,s,i),a={name:o.fullPath},c=wc(r),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":s.size(),"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Oc(o,n),l=t.maxUploadRetryTime,p=new Rc(c,"POST",(function(t){var e;jc(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){Mc(!1)}return Mc(hc(e)),e}),l);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=Pc(e),p}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),s=t._ref.storage.makeRequest(n,e);t._request=s,s.getPromise().then((function(e){t._request=void 0,t._uploadUrl=e,t._needToFetchStatus=!1,t.completeTransitions_()}),t._errorHandler)}))},t.prototype._fetchStatus=function(){var t=this,e=this._uploadUrl;this._resolveToken((function(n){var s=function(t,e,n,s){var i=t.maxUploadRetryTime,r=new Rc(n,"POST",(function(t){var e=jc(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){Mc(!1)}n||Mc(!1);var i=Number(n);return Mc(!isNaN(i)),new Fc(i,s.size(),"final"===e)}),i);return r.headers={"X-Goog-Upload-Command":"query"},r.errorHandler=Pc(e),r}(t._ref.storage,t._ref._location,e,t._blob),i=t._ref.storage.makeRequest(s,n);t._request=i,i.getPromise().then((function(e){e=e,t._request=void 0,t._updateProgress(e.current),t._needToFetchStatus=!1,e.finalized&&(t._needToFetchMetadata=!0),t.completeTransitions_()}),t._errorHandler)}))},t.prototype._continueUpload=function(){var t=this,e=Bc*this._chunkMultiplier,n=new Fc(this._transferred,this._blob.size()),s=this._uploadUrl;this._resolveToken((function(i){var r;try{r=Uc(t._ref._location,t._ref.storage,s,t._blob,e,t._mappings,n,t._makeProgressCallback())}catch(e){return t._error=e,void t._transition(rc)}var o=t._ref.storage.makeRequest(r,i);t._request=o,o.getPromise().then((function(e){t._increaseMultiplier(),t._request=void 0,t._updateProgress(e.current),e.finalized?(t._metadata=e.metadata,t._transition(nc)):t.completeTransitions_()}),t._errorHandler)}))},t.prototype._increaseMultiplier=function(){Bc*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},t.prototype._fetchMetadata=function(){var t=this;this._resolveToken((function(e){var n=Vc(t._ref.storage,t._ref._location,t._mappings),s=t._ref.storage.makeRequest(n,e);t._request=s,s.getPromise().then((function(e){t._request=void 0,t._metadata=e,t._transition(nc)}),t._metadataErrorHandler)}))},t.prototype._oneShotUpload=function(){var t=this;this._resolveToken((function(e){var n=function(t,e,n,s,i){var r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;var c=Lc(e,s,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Oc(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=_c.getBlob(u,s,h);if(null===l)throw Fa();var p={name:c.fullPath},d=wc(r),f=t.maxUploadRetryTime,m=new Rc(d,"POST",Dc(t,n),f);return m.urlParams=p,m.headers=o,m.body=l.uploadData(),m.errorHandler=Pc(e),m}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),s=t._ref.storage.makeRequest(n,e);t._request=s,s.getPromise().then((function(e){t._request=void 0,t._metadata=e,t._updateProgress(t._blob.size()),t._transition(nc)}),t._errorHandler)}))},t.prototype._updateProgress=function(t){var e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()},t.prototype._transition=function(t){if(this._state!==t)switch(t){case sc:case tc:this._state=t,void 0!==this._request&&this._request.cancel();break;case Ka:var e=this._state===ec;this._state=t,e&&(this._notifyObservers(),this._start());break;case ec:this._state=t,this._notifyObservers();break;case ic:this._error=La(),this._state=t,this._notifyObservers();break;case rc:case nc:this._state=t,this._notifyObservers()}},t.prototype.completeTransitions_=function(){switch(this._state){case tc:this._transition(ec);break;case sc:this._transition(ic);break;case Ka:this._start()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=ac(this._state);return new Wc(this._transferred,this._blob.size(),t,this._metadata,this,this._ref)},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e,n,s){var i=this,r=new zc(e,n,s);return this._addObserver(r),function(){i._removeObserver(r)}},t.prototype.then=function(t,e){return this._promise.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._addObserver=function(t){this._observers.push(t),this._notifyObserver(t)},t.prototype._removeObserver=function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},t.prototype._notifyObservers=function(){var t=this;this._finishPromise(),this._observers.slice().forEach((function(e){t._notifyObserver(e)}))},t.prototype._finishPromise=function(){if(void 0!==this._resolve){var t=!0;switch(ac(this._state)){case oc.SUCCESS:Gc(this._resolve.bind(null,this.snapshot))();break;case oc.CANCELED:case oc.ERROR:Gc(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}},t.prototype._notifyObserver=function(t){switch(ac(this._state)){case oc.RUNNING:case oc.PAUSED:t.next&&Gc(t.next.bind(t,this.snapshot))();break;case oc.SUCCESS:t.complete&&Gc(t.complete.bind(t))();break;case oc.CANCELED:case oc.ERROR:t.error&&Gc(t.error.bind(t,this._error))();break;default:t.error&&Gc(t.error.bind(t,this._error))()}},t.prototype.resume=function(){var t=this._state===ec||this._state===tc;return t&&this._transition(Ka),t},t.prototype.pause=function(){var t=this._state===Ka;return t&&this._transition(tc),t},t.prototype.cancel=function(){var t=this._state===Ka||this._state===tc;return t&&this._transition(sc),t},t}(),Xc=function(){function t(t,e){this._service=t,this._location=e instanceof gc?e:gc.makeFromUrl(e)}return t.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},t.prototype.newRef=function(e,n){return new t(e,n)},Object.defineProperty(t.prototype,"root",{get:function(){var t=new gc(this._location.bucket,"");return this.newRef(this._service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return yc(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===e)return null;var n=new gc(this._location.bucket,e);return new t(this._service,n)},enumerable:!1,configurable:!0}),t.prototype._throwIfRoot=function(t){if(""===this._location.path)throw Ua(t)},t}();function Yc(t){var e={prefixes:[],items:[]};return $c(t,e).then((function(){return e}))}function $c(t,e,n){return bo(this,void 0,void 0,(function(){var s,i,r;return xo(this,(function(o){switch(o.label){case 0:return[4,Zc(t,{pageToken:n})];case 1:return s=o.sent(),(i=e.prefixes).push.apply(i,s.prefixes),(r=e.items).push.apply(r,s.items),null==s.nextPageToken?[3,3]:[4,$c(t,e,s.nextPageToken)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}function Zc(t,e){return bo(this,void 0,void 0,(function(){var n,s,i;return xo(this,(function(r){switch(r.label){case 0:return null!=e&&"number"==typeof e.maxResults&&dc("options.maxResults",1,1e3,e.maxResults),[4,t.storage.getAuthToken()];case 1:return n=r.sent(),s=e||{},i=qc(t.storage,t._location,"/",s.pageToken,s.maxResults),[2,t.storage.makeRequest(i,n).getPromise()]}}))}))}function Qc(t,e){return bo(this,void 0,void 0,(function(){var n,s;return xo(this,(function(i){switch(i.label){case 0:return t._throwIfRoot("updateMetadata"),[4,t.storage.getAuthToken()];case 1:return n=i.sent(),s=function(t,e,n,s){var i=wc(e.fullServerUrl()),r=Oc(n,s),o=t.maxOperationRetryTime,a=new Rc(i,"PATCH",Dc(t,s),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=r,a.errorHandler=Nc(e),a}(t.storage,t._location,e,Sc()),[2,t.storage.makeRequest(s,n).getPromise()]}}))}))}function Jc(t){return bo(this,void 0,void 0,(function(){var e,n;return xo(this,(function(s){switch(s.label){case 0:return t._throwIfRoot("getDownloadURL"),[4,t.storage.getAuthToken()];case 1:return e=s.sent(),n=function(t,e,n){var s=wc(e.fullServerUrl()),i=t.maxOperationRetryTime,r=new Rc(s,"GET",Ic(t,n),i);return r.errorHandler=Nc(e),r}(t.storage,t._location,Sc()),[2,t.storage.makeRequest(n,e).getPromise().then((function(t){if(null===t)throw new _a(Ea,"The given file does not have any download URLs.");return t}))]}}))}))}function Kc(t){return bo(this,void 0,void 0,(function(){var e,n;return xo(this,(function(s){switch(s.label){case 0:return t._throwIfRoot("deleteObject"),[4,t.storage.getAuthToken()];case 1:return e=s.sent(),n=function(t,e){var n=wc(e.fullServerUrl()),s=t.maxOperationRetryTime,i=new Rc(n,"DELETE",(function(t,e){}),s);return i.successCodes=[200,204],i.errorHandler=Nc(e),i}(t.storage,t._location),[2,t.storage.makeRequest(n,e).getPromise()]}}))}))}function tu(t,e){var n=function(t,e){var n=e.split("/").filter((function(t){return t.length>0})).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),s=new gc(t._location.bucket,n);return new Xc(t.storage,s)}var eu=function(){function t(t,e,n){this._delegate=t,this.task=e,this.ref=n}return Object.defineProperty(t.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),t}(),nu=function(){function t(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate),this._snapshot=new eu(this._delegate.snapshot,this,this._ref)}return Object.defineProperty(t.prototype,"snapshot",{get:function(){return this._snapshot},enumerable:!1,configurable:!0}),t.prototype.then=function(t,e){var n=this;return this._delegate.then((function(e){if(t)return t(new eu(e,n,n._ref))}),e)},t.prototype.on=function(t,e,n,s){var i=this,r=void 0;return e&&(r="function"==typeof e?function(t){return e(new eu(t,i,i._ref))}:{next:e.next?function(t){return e.next(new eu(t,i,i._ref))}:void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,r,n||void 0,s||void 0)},t}(),su=function(){function t(t,e){this._delegate=t,this._service=e}return Object.defineProperty(t.prototype,"prefixes",{get:function(){var t=this;return this._delegate.prefixes.map((function(e){return new iu(e,t._service)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this;return this._delegate.items.map((function(e){return new iu(e,t._service)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),t}(),iu=function(){function t(t,e){this._delegate=t,this.storage=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this._delegate.toString()},t.prototype.child=function(e){return new t(tu(this._delegate,e),this.storage)},Object.defineProperty(t.prototype,"root",{get:function(){return new t(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._delegate.parent;return null==e?null:new t(e,this.storage)},enumerable:!1,configurable:!0}),t.prototype.put=function(t,e){return this._throwIfRoot("put"),new nu(function(t,e,n){return void 0===n&&(n=null),t._throwIfRoot("uploadBytesResumable"),new Hc(t,new _c(e),n)}(this._delegate,t,e),this)},t.prototype.putString=function(t,e,n){return void 0===e&&(e=Ga.RAW),this._throwIfRoot("putString"),new nu(function(t,e,n,s){void 0===n&&(n=Ga.RAW),t._throwIfRoot("putString");var i=Xa(n,e),r=wo({},s);return null==r.contentType&&null!=i.contentType&&(r.contentType=i.contentType),new Hc(t,new _c(i.data,!0),r)}(this._delegate,t,e,n),this)},t.prototype.listAll=function(){var t=this;return Yc(this._delegate).then((function(e){return new su(e,t.storage)}))},t.prototype.list=function(t){var e=this;return Zc(this._delegate,t).then((function(t){return new su(t,e.storage)}))},t.prototype.getMetadata=function(){return function(t){return bo(this,void 0,void 0,(function(){var e,n;return xo(this,(function(s){switch(s.label){case 0:return t._throwIfRoot("getMetadata"),[4,t.storage.getAuthToken()];case 1:return e=s.sent(),n=Vc(t.storage,t._location,Sc()),[2,t.storage.makeRequest(n,e).getPromise()]}}))}))}(this._delegate)},t.prototype.updateMetadata=function(t){return Qc(this._delegate,t)},t.prototype.getDownloadURL=function(){return Jc(this._delegate)},t.prototype.delete=function(){return this._throwIfRoot("delete"),Kc(this._delegate)},t.prototype._throwIfRoot=function(t){if(""===this._delegate._location.path)throw Ua(t)},t}(),ru=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}();var ou=function(){function t(t,e,n,s,i,r,o,a,c,u,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=s,this.successCodes_=i.slice(),this.additionalRetryCodes_=r.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=u,this.timeout_=c,this.pool_=h,this.promise_=new Promise((function(t,e){l.resolve_=t,l.reject_=e,l.start_()}))}return t.prototype.start_=function(){var t=this;function e(e,n){var s,i=t.resolve_,r=t.reject_,o=n.xhr;if(n.wasSuccessCode)try{var a=t.callback_(o,o.getResponseText());void 0!==a?i(a):i()}catch(t){r(t)}else null!==o?((s=qa()).serverResponse=o.getResponseText(),t.errorCallback_?r(t.errorCallback_(o,s)):r(s)):n.canceled?r(s=t.appDelete_?Ba():La()):r(s=new _a(xa,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new au(!1,null,!0)):this.backoffId_=function(t,e,n){var s=1,i=null,r=!1,o=0;function a(){return 2===o}var c=!1;function u(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];c||(c=!0,e.apply(null,t))}function h(e){i=setTimeout((function(){i=null,t(l,a())}),e)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!c)if(t)u.call.apply(u,ko([null,t],e));else{var i;a()||r?u.call.apply(u,ko([null,t],e)):(s<64&&(s*=2),1===o?(o=2,i=0):i=1e3*(s+Math.random()),h(i))}}var p=!1;function d(t){p||(p=!0,c||(null!==i?(t||(o=2),clearTimeout(i),h(0)):t||(o=1)))}return h(0),setTimeout((function(){r=!0,d(!0)}),n),d}((function(e,n){if(n)e(!1,new au(!1,null,!0));else{var s=t.pool_.createXhrIo();t.pendingXhr_=s,null!==t.progressCallback_&&s.addUploadProgressListener(i),s.send(t.url_,t.method_,t.body_,t.headers_).then((function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var s=(n=n).getErrorCode()===Qa.NO_ERROR,r=n.getStatus();if(s&&!t.isRetryStatusCode_(r)){var o=-1!==t.successCodes_.indexOf(r);e(!0,new au(o,n))}else{var a=n.getErrorCode()===Qa.ABORT;e(!1,new au(!1,null,a))}}))}function i(e){var n=e.loaded,s=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,s)}}),e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),s=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||s},t}(),au=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function cu(t,e,n,s){var i=bc(t.urlParams),r=t.url+i,o=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(o,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,n),function(t){var e=void 0!==fa?fa.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new ou(r,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s)}function uu(t){return/^[A-Za-z]+:\/\//.test(t)}function hu(t,e){if(t instanceof fu){var n=t;if(null==n._bucket)throw new _a(ka,"No default bucket found. Did you set the 'storageBucket' property when initializing the app?");var s=new Xc(n,n._bucket);return null!=e?hu(s,e):s}if(void 0!==e){if(e.includes(".."))throw ja('`path` param cannot contain ".."');return tu(t,e)}return t}function lu(t,e){if(e&&uu(e)){if(t instanceof fu)return new Xc(t,e);throw ja("To use ref(service, url), the first argument must be a Storage instance.")}return hu(t,e)}var pu,du,fu=function(){function t(t,e,n,s){var i,r;this.app=t,this._authProvider=e,this._pool=n,this._url=s,this._bucket=null,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?gc.makeFromBucketSpec(s):(i=this.app.options,null==(r=null==i?void 0:i.storageBucket)?null:gc.makeFromBucketSpec(r))}return Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(t){dc("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(t){dc("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t},enumerable:!1,configurable:!0}),t.prototype.getAuthToken=function(){return bo(this,void 0,void 0,(function(){var t,e;return xo(this,(function(n){switch(n.label){case 0:return(t=this._authProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:if(null!==(e=n.sent()))return[2,e.accessToken];n.label=2;case 2:return[2,null]}}))}))},t.prototype._delete=function(){return this._deleted=!0,this._requests.forEach((function(t){return t.cancel()})),this._requests.clear(),Promise.resolve()},t.prototype.makeStorageReference=function(t){return new Xc(this,t)},t.prototype.makeRequest=function(t,e){var n=this;if(this._deleted)return new ru(Ba());var s=cu(t,this._appId,e,this._pool);return this._requests.add(s),s.getPromise().then((function(){return n._requests.delete(s)}),(function(){return n._requests.delete(s)})),s},t}(),mu=function(){function t(t,e){var n=this;this.app=t,this._delegate=e,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){if(uu(t))throw ja("ref() expected a child path but got a URL, use refFromURL instead.");return new iu(lu(this._delegate,t),this)},t.prototype.refFromURL=function(t){if(!uu(t))throw ja("refFromURL() expected a full URL but got a child path, use ref() instead.");try{gc.makeFromUrl(t)}catch(t){throw ja("refFromUrl() expected a valid full URL but got an invalid one.")}return new iu(lu(this._delegate,t),this)},t.prototype.setMaxUploadRetryTime=function(t){this._delegate.maxUploadRetryTime=t},t.prototype.setMaxOperationRetryTime=function(t){this._delegate.maxOperationRetryTime=t},t}();function _u(t,e){var n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal");return new mu(n,new fu(n,s,new uc,e))}du={TaskState:oc,TaskEvent:Ja,StringFormat:Ga,Storage:fu,Reference:iu},(pu=fa).INTERNAL.registerComponent(new Fo("storage",_u,"PUBLIC").setServiceProps(du).setMultipleInstances(!0)),pu.registerVersion("@firebase/storage","0.4.2");var gu=i(877);const vu=class{constructor(t,e="audio/mpeg-3"){this.firebaseConfig={apiKey:"AIzaSyAbb8-7skMg99nzAlvUaqR6vfQvD7q_7Vs",authDomain:"test-a201f.firebaseapp.com",databaseURL:"https://test-a201f.firebaseio.com",projectId:"test-a201f",storageBucket:"test-a201f.appspot.com",messagingSenderId:"120555329679",appId:"1:120555329679:web:a8734f69a5da95480df8fa",measurementId:"G-QLSEEEE02P"},this.suffix="audio/mpeg-3"===e?"mp3":"aac",fa.initializeApp(this.firebaseConfig),this.audioCtx=t,this.storage=fa.storage(),this.storageRef=this.storage.ref(),this.audioRef=this.storageRef.child(`audio-${(0,gu.v4)()}.${this.suffix}`)}async listAll(){this.files=await this.storageRef.list()}async getAacFiles(){return new Promise((async(t,e)=>{this.filePromises=[],this.fileNames=[],this.files.items.forEach((async t=>{this.filePromises.push(t.getMetadata())})),this.filesMetadata=await Promise.all(this.filePromises),this.filesMetadata.filter((t=>{"audio/aac"===t.contentType&&this.fileNames.push(t.fullPath)})),console.log(`Found ${this.fileNames.length} files`),this.fileNames.slice(0,10),console.log(this.fileNames),t(this.fileNames)}))}async getRandomSample(){if("aac"===!this.suffix){const t=this.files.items[~~(Math.random()*this.files.items.length)];this.audioFile=await t.getDownloadURL()}}async downloadSample(t){return fetch(t,{cors:"opaque"}).then((t=>t.arrayBuffer())).then((t=>this.audioCtx.decodeAudioData(t))).catch((t=>console.log(t)))}async uploadSample(t){this.uploadTask=this.audioRef.put(t,{contentType:t.type}),this.uploadTask.on("state_changed",(t=>{this.progress=t.bytesTransferred/t.totalBytes*100,fa.storage.TaskState.RUNNING}),(t=>{}),(()=>{this.uploadTask.snapshot.ref.getDownloadURL().then((function(t){window.logging&&console.log("File available at",t)}))}))}};function yu(t,e,n,s,i){return(t-e)*(i-s)/(n-e)+s}function wu(t){return new Promise(((e,n)=>{if(!1===Object&&(xu("buffer is invalid. Skipping"),n(!1)),t){const n=t.getChannelData(0),i=Math.floor(.05*t.sampleRate);let r=[],o=0;for(var s=0;s<n.length;s++)o+=n[s]**2,s%i==0&&(o=Math.sqrt(o/i),r.push(o),o=0);r.sort(((t,e)=>t-e));let a,c=r[Math.floor(.95*r.length)],u=1/c,h=1-c;xu("INITIAL GAIN:"+u/10),xu("DIFF:"+h),h>.99?(xu("possible error. being safe"),a=2e3,u/=.3):a=7e3,u=Math.min(u,a),u=Math.max(u,3),xu("Adjusted gain x "+u/10),e((u/10).toFixed(2))}}))}function bu(t){return t[Math.floor(Math.random()*t.length)]}function xu(t){window.logging&&console.log(`%cSound: ${t}`,"color:#233E82; font-family:'Arial';color:white; font-weight: 500; background:black;")}const Tu=class{constructor(t=800,e){this.length=t,this.audioCtx=e}async getPermissions(){return new Promise((async(t,e)=>{try{let n=setTimeout((()=>{e("permissions timed out")}),5e3);const s=navigator.mediaCapabilities.decodingInfo({type:"file",audio:{contentType:"audio/mp3"}}).then((t=>t.supported));!0===await s?this.type="audio/mpeg-3":this.type="audio/aac",console.log(this.type);const i=await navigator.mediaDevices.getUserMedia({audio:!0});this.stream=i,clearTimeout(n),t(i)}catch(t){return xu(t),!1}}))}stopStream(){this.stream.getTracks().forEach((t=>{"live"==t.readyState&&"audio"===t.kind&&t.stop()}))}startStream(){this.stream.getTracks().forEach((t=>{"live"==t.readyState&&"audio"===t.kind&&t.start()}))}async recordChunks(){return new Promise(((t,e)=>{this.recording=!0,this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.audioChunks=[],this.mediaRecorder.addEventListener("dataavailable",(e=>{this.audioChunks.push(e.data),t(!0)}))}))}async stopRecording(){return new Promise(((t,e)=>{this.mediaRecorder.stop(),this.recording=!1,this.mediaRecorder.addEventListener("stop",(()=>{this.audioBlob=new Blob(this.audioChunks,{type:this.type}),xu(this.audioBlob),this.audioUrl=URL.createObjectURL(this.audioBlob),t(this.audioBlob)}))}))}readBlobAsArrayBuffer(t){const e=new FileReader;return new Promise(((n,s)=>{e.onerror=()=>{e.abort(),s(new DOMException("Problem parsing input file."))},e.onload=()=>{n(e.result)},e.readAsArrayBuffer(t)}))}async loadToBuffer(t){if(!this.recording){const e=await this.readBlobAsArrayBuffer(t);let n;this.arrayBuffer=e;try{n=await this.audioCtx.decodeAudioData(this.arrayBuffer)}catch(t){n=this.audioContext.decodeAudioData((t=>t))}return new Promise(((t,e)=>{try{t(n),this.decodedBuffer=n}catch(t){e(t)}}))}}};const Cu=class{constructor(t){this.input=new Qi(6),this.limiter=new fo(-6),this.input.connect(this.limiter),this.effectsChain=[],this.ctx=t,this.output=new fo(0),this.dest=this.ctx.destination,this.output.connect(this.dest),this.chainEffect(this.limiter)}test(){var t=new lr(440);t.frequency.setValueAtTime(440,this.ctx.currentTime),t.connect(this.input),t.start()}setVolume(t){this.output.gain.setValueAtTime(t,this.ctx.getCurrentTime)}connectSource(t){try{return this.source=t,t.connect(this.input),!0}catch(t){return!1}}chorus(t=.1,e=20,n=.9){this.chorus=new to(t,e,n).start(),this.chainEffect(this.chorus)}chainEffect(t){if(this.effectsChain.push(t),this.effectsChain.length>1){const t=this.effectsChain[0],e=this.effectsChain[this.effectsChain.length-1];this.input.disconnect(),e&&e.disconnect(),this.input.connect(t);for(let t=0;t<this.effectsChain.length-1;t++)this.effectsChain[t].connect(this.effectsChain[t+1]);e.connect(this.output)}else this.input.connect(this.effectsChain[0]).connect(this.output)}removeEffect(t){this.output.disconnect(t),this.output.connect(this.dest)}lowpassFilter(t,e){this.filter=new jr(t,"lowpass",e),this.chainEffect(this.filter)}delay(t=100,e=.5){this.masterDelay=new no(t,e),this.chainEffect(this.masterDelay)}meterNode(t){this.meter=new ao({smoothing:.8}),t.connect(this.meter),window.meterLoop=setInterval((()=>{window.masterLevel=this.meter.getValue()}),300)}async reverb(t,e=.3,n=4,s=1){t?(this.masterReverb=new io({preDelay:e,decay:n,wet:s}),await this.masterReverb.generate(),this.chainEffect(this.masterReverb)):this.masterReverb&&this.removeEffect(this.masterReverb)}disconnect(){this.dest.disconnect()}};const Su=class{constructor(t,e=3){this.randomValues=[...Array(20)].map((()=>Math.floor(6*Math.random()))),this.ctx=t,this.isPlaying=!1,this.uiSynth=new Gr({polyphony:e,voice:Fr,maxPolyphony:e}),this.uiSynth.set({envelope:{attack:0,decay:.5,sustain:0,release:.7},harmonicity:2,volume:1}),this.idx=0,this.master=new Qi(-10),this.uiSynth.connect(this.master)}play(t){this.isPlaying=!0,this.notes=t.slice(0,this.uiSynth.maxPolyphony),this.idx++,this.uiSynth.set({harmonicity:this.randomValues[this.idx%this.randomValues.length]});try{this.uiSynth.triggerAttackRelease(this.notes,mo()),this.uiSynth.releaseAll(),this.isPlaying=!1}catch(t){this.uiSynth.releaseAll(),this.isPlaying=!1}}};function ku(t,e){t.style.display="none",e.style.display="inline-block"}function Au(t){window.isMuted?t.innerHTML="unmute sound":t.innerHTML="mute sound"}di().rawContext.suspend(),window.debounce=function(t,e){let n;return function(...s){n&&clearTimeout(n),n=setTimeout((()=>{t(...s)}),e)}},window.probeLevel=function(t,e=10){console.log(t);let n=0;const s=new ao;t.connect(s);const i=setInterval((()=>{console.log(s.getValue()),n++,n>=e&&(t.disconnect(s),clearInterval(i),n=0)}),100)};const Ou=window.innerWidth<600;let Eu=navigator.mediaCapabilities.decodingInfo({type:"file",audio:{contentType:"audio/mp3"}}).then((t=>t.supported)),Ru=!1,Mu=Ou?1:3,Du=0,Iu=null;window.recordingLimitReached=!1,window.recording=!1,window.isMuted=!0,window.logging=!1;let Pu=new ri({sampleRate:22050,latencyHint:"playback",updateInterval:1,lookAhead:.5,bufferSize:4096,state:"suspended"}),Nu=di().transport;Nu.PPQ=8;let Vu=0;Pu.name="Playback Context";const qu=async()=>{xu("attempting to start audio"),await Pu.rawContext.resume(),await mi(),window.isSoundStarted=!0,xu("Audio context is: "+Pu.rawContext.state),xu("Asking for microphone permissions");try{!Wu.stream&&await Wu.getPermissions()}catch(t){console.log(t)}};let Lu;fi(Pu);let Fu=[],ju=Ou?1:3,Bu=3;navigator.deviceMemory&&(ju=navigator.deviceMemory/4,Bu=navigator.deviceMemory/2),window.synthsLoaded=!1;const Uu=new Su(Pu,Bu);let zu=new vu(Pu);let Wu=new Tu(500,Pu);const Gu=document.querySelector("#mute"),Hu=document.querySelector("#play"),Xu=document.querySelector("#audiotooltip");let Yu;Hu.addEventListener("click",(()=>{const t=setTimeout((()=>{qu()}),1e4);qu(),clearTimeout(t),ku(Hu,Gu)})),Gu.onclick=async()=>{var t,e;Vu++,window.isMuted=!window.isMuted,t=window.isMuted,e=Gu,t?(e.classList.add("fa-volume-off"),e.classList.remove("fa-volume-up")):(e.classList.remove("fa-volume-off"),e.classList.add("fa-volume-up")),window.synthsLoaded&&(window.isMuted?rh():1===Vu?eh():oh())};let $u=0;window.addEventListener("radius_reached",(async()=>{$u++,$u%5==0&&(xu("5 pixels have died... reloading buffers"),window.loadingBuffers||await Qu())}));const Zu=t=>{const e=new ao;t.connect(e);let n=e.getValue();return console.log(n),e.disconnect(),n},Qu=async(t=null)=>new Promise((async(e,n)=>{if(window.loadingBuffers=!0,t)xu("CUSTOM BUFFER!"),console.log(t),t.idealGain=await wu(t),Fu.forEach((e=>{try{e.grainOutput.gain.value=t.idealGain;try{e.buffer.copyToChannel(t.getChannelData(0),0,0),e.reloadBuffers()}catch(n){e.buffer=t}}catch(t){xu("error loading user buffer, continuing")}e.reloadBuffers(),e.randomStarts(),e.randomInterpolate()})),window.loadingBuffers=!1,t=null,e(!0);else{let t=await Ju(window.isMp3);try{console.log("reloading buffers"),t.forEach((async(e,n)=>{try{console.log("changing buffers"),Fu[n].grainOutput.gain.setValueAtTime(e.idealGain/ju,Pu.currentTime),Fu[n].buffer.copyToChannel(t[n].getChannelData(0),0,0)}catch(t){console.log("buffercopy failed... reverting to original buffer")}Fu[n].reloadBuffers(),Fu[n].randomStarts(),Fu[n].randomInterpolate()})),window.loadingBuffers=!1,e(!0)}catch(t){console.log("error resolving buffers"),Qu()}}}));window.reloadBuffers=Qu;window.addEventListener("down",(async()=>{Ru||window.isMuted||(Ru=await Wu.getPermissions(),xu(`user has ${Ru?"":"not"} allowed recording.`)),!window.isMuted&&Ru&&(Du++,Du>Mu&&(window.recordingLimitReached=!0),!window.recordingLimitReached&&Ru?(async()=>{new Promise((async(t,e)=>{if(window.MediaRecorder&&Ru&&!window.isMuted)try{xu("started user recording #"+Du),window.recording=!0,await Wu.recordChunks(),t(!0)}catch(t){xu(t),e(!1)}else window.recording=!1,e(!1),xu("media recording is not supported in this browser")}))})():xu("user recording limit reached"))})),window.addEventListener("released",(()=>{window.isMuted||(window.recordingLimitReached||setTimeout((()=>{(async()=>{if(Wu.recording&&Ru){const t=await Wu.stopRecording();try{Iu=await Wu.loadToBuffer(t)}catch(t){xu(t)}await Qu(Iu),zu.uploadSample(Wu.audioBlob),xu("stopped user recording #"+Du),window.recording=!1,console.log(Pu.state),"suspended"===Pu.state&&await qu()}else window.recording=!1})()}),100),xu("mouse is released"))}));const Ju=async t=>(xu(`mp3 is ${t?"":"not "}supported in this browser`),null==zu.files&&await zu.listAll(),new Promise((async(e,n)=>{let s,r=[],o=[];if(t)o=await Promise.all(Array.from({length:ju},(()=>bu(zu.files.items).getDownloadURL()))),o.forEach((t=>{r.push(async function(t,e,n="audio/mpeg-3"){return fetch(t).then((t=>t.arrayBuffer())).then((t=>e.decodeAudioData(t))).catch((t=>xu(t)))}(t,Pu))}));else{void 0===zu.fileNames&&await zu.getAacFiles();let t=Array.from({length:ju},(()=>{let t=bu(zu.fileNames);return zu.storageRef.child(t).getDownloadURL()}));o=await Promise.all(t),o.forEach((t=>r.push(async function(t,e){let n,s;return new Promise((async(r,o)=>{try{n=await fetch(t,{mimeType:"audio/aac"}),s=await n.arrayBuffer()}catch(t){i.e(823).then(i.bind(i,823)).then((async t=>{n=await fetch(t.default,{mimeType:"audio/aac"}),s=await n.arrayBuffer()}))}let a;try{a=await Gn(e._context._nativeContext,s)}catch(t){i.e(823).then(i.bind(i,823)).then((async t=>{n=await fetch(t.default,{mimeType:"audio/aac"}),s=await n.arrayBuffer(),a=await Gn(e._context._nativeContext,s)}))}xu(a),r(a)}))}(t,Pu))))}try{s=await Promise.all(r),s.forEach((async t=>{t.idealGain=await wu(t)})),s.includes(void 0)&&console.log("buffer array included undefined buffer. Trying again"),e(s)}catch(t){xu("invalid audio file, trying again"),Ju()}}))),Ku=async()=>new Promise((async(t,e)=>{let n;try{n=await Ju(window.isMp3)}catch(t){console.log(t),n=await Ju(window.isMp3)}for(let t=0;t<ju;t++)n[t]&&(Fu.push(new go(n[t],Pu,Bu)),Fu.forEach((e=>{e.filter.frequency.value=220,e.filter.Q.value=5,n[t].idealGain&&(e.grainOutput.gain.value=n[t].idealGain/ju)})),xu("Loaded GrainSynth "+(t+1)));var s;th(),(()=>{Yu=new _r({frequency:40,harmonicity:.5,volume:-18}),Yu.filter=new jr({frequency:20,gain:10}),Yu.connect(Yu.filter);const t=new rr({type:"pink",volume:-14});t.connect(Yu.filter),Lu.connectSource(Yu.filter),Yu.volume.targetRampTo(-18,10),Yu.filter.gain.value=10,t.start("+2"),Yu.start("+2")})(),ku(Hu,Gu),(s=Gu).classList.add("fa","fa-volume-off"),s.disabled=!1,Au(Xu),t(!0)})),th=()=>{Lu=new Cu(Pu),Lu.connectSource(Uu.master),window.isMp3&&Lu.chorus(.01,300,.9),!Ou&&window.isMp3&&Lu.reverb(!0,.3,3,.7),window.synthsLoaded=!0,Gu.classList=[],xu("Voices loaded")},eh=async()=>{Wu.stream||await Wu.getPermissions(),Au(Xu),window.isMuted||(await mi(),await Pu.resume(),Fu.forEach((async(t,e)=>{await t.isGrainLoaded(t.grains[t.grains.length-1]),window.logging&&xu(t),t.isStopped||(t.randomInterpolate(),t.play(Pu.currentTime+.05*e),t.output.disconnect(t.dest),Lu.connectSource(t.output))})),nh(),sh()),"closed"===Pu.state&&(xu("audio context is closed by user gesture, restarting"),await Pu.rawContext.resume())},nh=()=>{try{_o.scheduleRepeat((t=>{ih()}),10)}catch(t){xu(t)}},sh=()=>{Nu&&Nu.scheduleRepeat((t=>{Yu.detune.rampTo(yu(Math.random(),0,1,-100,100),30),Yu.harmonicity.rampTo(yu(Math.random(),0,1,.5,2),30)}),30)},ih=()=>{try{if(ps.particles){let{radius:t,maxradius:e}=ps.particles[ps.particles.length-1];Fu.forEach(((n,s)=>{let i=(s+1)*yu(t,0,e,110,880);!Ou&&n.filter.frequency.rampTo(i,5)})),Yu.filter.frequency.rampTo(yu(~~t,0,~~e,50,200),10)}}catch(t){console.warn("particle system not defined, threw error"+t)}},rh=()=>{"running"===Pu.state&&Pu.rawContext.suspend()},oh=()=>{Pu.rawContext.resume()};(async()=>{window.isMp3=await Eu,window.isMp3||(zu.suffix="aac",ju=1,Bu=2),await Pu.rawContext.resume(),await Ku(),window.synths=Fu,window.ctx=Pu,window.sourceCount=Pu.rawContext._nativeAudioContext.activeSourceCount,window.masterBus=Lu,window.checkOutput=Zu,window.addEventListener("pixel_added",(t=>{t.preventDefault(),xu("pixel added"),!window.isMuted&&!Uu.isPlaying&&Uu.play([~~t.data.pixelX,window.height-~~t.data.pixelY])}));document.querySelectorAll("canvas").forEach((t=>{"none"===t.style.display&&t.parentNode.removeChild(t)}))})()})()})();
//# sourceMappingURL=soundmain.js.map